<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الخريطة التفاعلية لاحتراف C# وتحليل البيانات</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4F46E5; /* Indigo */
            --primary-hover: #4338CA;
            --secondary-color: #10B981; /* Emerald */
            --completed-color: #059669; /* Green 600 */
            --background-color: #F9FAFB; /* Gray 50 */
            --card-background: #FFFFFF;
            --text-primary: #1F2937; /* Gray 800 */
            --text-secondary: #6B7280; /* Gray 500 */
            --border-color: #E5E7EB; /* Gray 200 */
            --english-color: #8B5CF6; /* Violet */
        }
        
        html.dark {
            --primary-color: #6366F1;
            --primary-hover: #4F46E5;
            --background-color: #111827; /* Gray 900 */
            --card-background: #1F2937; /* Gray 800 */
            --text-primary: #F9FAFB; /* Gray 50 */
            --text-secondary: #D1D5DB; /* Gray 300 - Lighter for better contrast */
            --border-color: #374151; /* Gray 700 */
            --completed-color: #10B981;
            --english-color: #A78BFA;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
            background-image: radial-gradient(var(--border-color) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .header-gradient {
            background: linear-gradient(180deg, #f0f2ff 0%, var(--background-color) 100%);
        }
        html.dark .header-gradient {
            background: linear-gradient(180deg, #1f2937 0%, var(--background-color) 100%);
        }
        .active-filter {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 4px 14px 0 rgba(79, 70, 229, 0.39);
        }
        .week-card {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease, background-color 0.3s, opacity 0.3s;
            position: relative;
            overflow: hidden;
        }
        .week-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 0 30px rgba(79, 70, 229, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: var(--primary-color);
        }
         html.dark .week-card:hover {
             box-shadow: 0 0 30px rgba(99, 102, 241, 0.25);
        }
        .week-card.completed {
            opacity: 0.7;
            border-left: 5px solid var(--completed-color);
        }
        .week-card.completed .completed-overlay {
            opacity: 1;
        }
        .completed-overlay {
            position: absolute;
            top: 0; right: 0; bottom: 0; left: 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: grayscale(80%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        html.dark .completed-overlay {
            background: rgba(0,0,0,0.2);
        }
        .completed-check-icon {
            position: absolute;
            top: 1rem;
            left: 1rem;
            color: var(--completed-color);
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s ease;
        }
        .week-card.completed .completed-check-icon {
            opacity: 1;
            transform: scale(1);
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
        }
        .current-week {
            border: 2px solid var(--secondary-color);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: var(--card-background);
            margin: 5% auto;
            padding: 2.5rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 900px; /* Increased width for two columns */
            animation: fadeIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-top: 5px solid var(--primary-color);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in-up {
            opacity: 0;
            animation: fadeInUp 0.8s ease-out forwards;
        }
        .phase-title {
            position: relative;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .phase-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border-radius: 2px;
        }
        .copy-btn {
            background-color: var(--border-color);
            transition: background-color 0.2s;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        html.dark .copy-btn {
             background-color: #374151;
        }
        .copy-btn:hover {
            background-color: #D1D5DB;
        }
        html.dark .copy-btn:hover {
            background-color: #4B5563;
        }
        .copied-feedback {
            color: var(--secondary-color);
            font-weight: bold;
        }
        .progress-bar-container {
            width: 100%;
            background-color: var(--border-color);
            border-radius: 9999px;
            overflow: hidden;
            height: 1.25rem;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            transition: width 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            text-align: center;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .parallel-track-badge {
            font-size: 10px;
            font-weight: bold;
            background-color: var(--secondary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 9999px;
        }
        .btn-complete {
            background-color: var(--border-color);
            color: var(--text-secondary);
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }
        .btn-complete:hover {
            background-color: var(--completed-color);
            color: white;
        }
        .week-card.completed .btn-complete {
             background-color: var(--completed-color);
             color: white;
        }
        .gemini-loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: auto;
        }
        html.dark .gemini-loader {
            border-color: #374151;
            border-top-color: var(--primary-color);
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .phase-summary-card {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-left: 5px solid var(--primary-color);
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03);
        }
        html.dark .phase-summary-card {
            background-color: rgba(30, 41, 59, 0.5);
        }
        .tech-icon-container {
            display: flex;
            gap: 0.75rem;
            color: var(--text-secondary);
        }
        .tech-icon-container svg {
            width: 24px;
            height: 24px;
            transition: color 0.2s ease-in-out;
        }
        .tech-icon-container:hover svg {
            color: var(--text-primary);
        }
        .gemini-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 600;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            color: white;
            border: 1px solid transparent;
        }
        .gemini-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .gemini-btn-explain { background-image: linear-gradient(to right, #4f46e5, #6366f1); border-color: #4338ca; }
        .gemini-btn-project { background-image: linear-gradient(to right, #059669, #10b981); border-color: #047857; }
        .gemini-btn-plan { background-image: linear-gradient(to right, #d97706, #f59e0b); border-color: #b45309; }
        .gemini-btn-translate { background-image: linear-gradient(to right, #0284c7, #0ea5e9); border-color: #0369a1; }
        .gemini-btn-quiz { background-image: linear-gradient(to right, #8b5cf6, #c084fc); border-color: #7e22ce; }
        .gemini-btn-interview { background-image: linear-gradient(to right, #6b7280, #4b5563); border-color: #374151; }
        .gemini-btn-review { background-image: linear-gradient(to right, #db2777, #ec4899); border-color: #be185d; }
        .gemini-btn-career { background-image: linear-gradient(to right, #f43f5e, #fb7185); border-color: #e11d48; }
        .gemini-btn-search { background-image: linear-gradient(to right, #3b82f6, #60a5fa); border-color: #2563eb; }
        .gemini-btn-image { background-image: linear-gradient(to right, #06b6d4, #22d3ee); border-color: #0891b2; }

        .summary-toggle-icon {
            transition: transform 0.3s ease;
        }
        .summary-content.hidden {
            display: none;
        }
        .summary-header.collapsed .summary-toggle-icon {
            transform: rotate(-90deg);
        }
        
        /* Specific dark mode adjustments */
        html.dark .bg-white { background-color: var(--card-background); }
        html.dark .text-gray-700 { color: var(--text-secondary); }
        html.dark .text-gray-800 { color: var(--text-primary); }
        html.dark .text-gray-900 { color: var(--text-primary); }
        html.dark .text-gray-600 { color: var(--text-secondary); }
        html.dark .text-gray-500 { color: #9CA3AF; } /* Gray 400 - Was too dark */
        html.dark .bg-gray-50 { background-color: #374151; }
        html.dark .border-gray-200 { border-color: #4B5563; }
        html.dark .shadow-md { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.4), 0 2px 4px -1px rgba(0,0,0,0.2); }
        html.dark .bg-indigo-100 { background-color: rgba(99, 102, 241, 0.2); }
        html.dark .text-indigo-800 { color: #A5B4FC; }
        html.dark .bg-emerald-100 { background-color: rgba(16, 185, 129, 0.2); }
        html.dark .text-emerald-800 { color: #6EE7B7; }
        html.dark .bg-indigo-50 { background-color: rgba(99, 102, 241, 0.1); }
        html.dark .border-indigo-500 { border-color: var(--primary-color); }
        html.dark .bg-gray-100 { background-color: #374151; }
        html.dark .border-indigo-200 { border-color: #4f46e5; }
        html.dark .border-emerald-200 { border-color: #10b981; }
        html.dark .bg-yellow-100 { background-color: rgba(245, 158, 11, 0.2); }
        html.dark .text-yellow-800 { color: #FCD34D; }
        html.dark .bg-sky-100 { background-color: rgba(14, 165, 233, 0.2); }
        html.dark .text-sky-800 { color: #7DD3FC; }
    </style>
     <script>
        // On page load or when changing themes, best to add inline in `head` to avoid FOUC
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>
</head>
<body class="antialiased">

    <div class="container mx-auto px-4 py-8">
        
        <header class="text-center mb-12 header-gradient pt-8 relative">
             <div class="absolute top-4 right-4 z-10">
                <button id="theme-toggle" type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5">
                    <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.707.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM10 16a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM3.05 4.536a1 1 0 011.414 0l.707.707a1 1 0 11-1.414 1.414l-.707-.707a1 1 0 010-1.414zM16.95 15.464a1 1 0 01-1.414 0l-.707-.707a1 1 0 111.414-1.414l.707.707a1 1 0 010 1.414zM1 10a1 1 0 011-1h1a1 1 0 110 2H2a1 1 0 01-1-1zm14 0a1 1 0 011-1h1a1 1 0 110 2h-1a1 1 0 01-1-1z"></path></svg>
                </button>
            </div>
            <h1 class="text-4xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-emerald-500 mb-3" style="animation: fadeInUp 1s ease-out;">الخريطة التفاعلية لاحتراف C# وتحليل البيانات</h1>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto" style="animation: fadeInUp 1.2s ease-out;">
                خارطتك الشخصية لمتابعة تقدمك نحو احتراف تطوير البرمجيات وتحليل البيانات. أكمل الأسابيع، وراقب تقدمك، وحقق أهدافك.
            </p>
            <div class="mt-6 text-sm text-gray-500" style="animation: fadeInUp 1.4s ease-out;">
                <span id="date-range"></span>
            </div>
        </header>
        
        <div id="progress-section" class="mb-12" style="animation: fadeInUp 1.6s ease-out;">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">تقدمك في الرحلة</h2>
            <div class="max-w-4xl mx-auto">
                <div class="progress-bar-container shadow-inner">
                    <div id="progressBar" class="progress-bar">0%</div>
                </div>
            </div>
        </div>


        <main>
            <section id="filters" class="mb-12" style="animation: fadeInUp 1.8s ease-out;">
                <div class="flex flex-col sm:flex-row justify-center items-center gap-6 mb-8">
                     <div>
                        <h3 class="font-bold text-center mb-2 text-gray-800">تصفية حسب المرحلة:</h3>
                        <div id="filter-buttons" class="flex flex-wrap justify-center gap-3"></div>
                     </div>
                     <div>
                        <h3 class="font-bold text-center mb-2 text-gray-800">تصفية حسب الحالة:</h3>
                        <div id="status-filter-buttons" class="flex flex-wrap justify-center gap-3"></div>
                     </div>
                </div>
            </section>
            
            <section id="roadmap">
                <div id="weeks-container" class="space-y-12">
                </div>
            </section>
            
            <hr class="my-16 border-t border-gray-200">

            <section id="visualization" class="mb-12">
                 <h2 class="text-3xl font-bold text-center mb-4 text-gray-800">نظرة عامة على الخطة</h2>
                 <p class="text-center text-gray-600 mb-8 max-w-2xl mx-auto">
                    هذا الرسم البياني يوضح توزيع الأسابيع على المراحل التعليمية المختلفة. يساعدك هذا التصور في فهم بنية المسار التعليمي وأين سيتم تركيز جهدك الأكبر.
                </p>
                <div class="chart-container fade-in-up">
                    <canvas id="phasesChart"></canvas>
                </div>
            </section>
        </main>
    </div>

    <div id="detailsModal" class="modal">
        <div class="modal-content relative">
            <button id="closeModal" class="absolute top-4 left-4 text-3xl font-bold text-gray-400 hover:text-gray-700 transition-colors">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        const roadmapData = [
    // Phase 1: C# Foundation
    { 
        phase: "تأسيس C#", week: 1, title: "أساسيات لغة C#", 
        goals: ["فهم المتغيرات وأنواع البيانات", "كتابة جمل شرطية (if, switch)", "استخدام الحلقات التكرارية (for, while)", "كتابة وتشغيل أول برنامج Console"], 
        lessons: ["Variables & Data Types", "Operators", "Control Flow (if/else, switch)", "Loops (for, while, do-while)", "Basic Input/Output"], 
        project: "برنامج آلة حاسبة بسيطة في الـ Console: إدخال رقمين ← اختيار العملية ( + − × ÷ ) ← عرض النتيجة ← خيار إعادة التشغيل.", 
        youtubeKeywords: ["C# basics for absolute beginners", "C# variables and data types", "C# if else statement", "C# for loop tutorial"], 
        parallelTrack: { 
            title: "SQL لتحليل البيانات (أساسيات)",
            icon: 'sql',
            goals: ["فهم مفهوم قواعد البيانات العلائقية", "كتابة استعلام SELECT بسيط", "استخدام WHERE لتصفية النتائج"],
            lessons: ["What is SQL?", "SELECT Statement", "WHERE Clause", "Basic Operators (=, <, >, LIKE)"],
            youtubeKeywords: ["sql basics for beginners", "sql select statement tutorial", "sql where clause examples"],
            project: "كتابة استعلامات لاسترجاع بيانات من جدول عملاء افتراضي (جميع العملاء من مدينة معينة، العملاء الذين أعمارهم فوق 30)"
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: book, car, house, friend, work, city, water, food, time, money, computer, code, project, error, bug, solution, app, web, data, system", "القاعدة: تكوين جملة بسيطة (Subject + Verb). مثال: 'I work.'"]
        },
        aiTools: []
    },
    { 
        phase: "تأسيس C#", week: 2, title: "الدوال وتصحيح الأخطاء", 
        goals: ["كتابة واستدعاء الدوال (Methods)", "فهم تمرير المعلمات (Parameters)", "استخدام نقاط التوقف (Breakpoints) لتصحيح الأخطاء"],
        lessons: ["Methods", "Parameters and Arguments", "Return Values", "Basic Debugging", "Exception Handling (try-catch)"], 
        project: "تطوير الآلة الحاسبة: تحويل كل عملية حسابية (جمع، طرح...) إلى دالة منفصلة، وإضافة تعامل مع الأخطاء مثل القسمة على صفر.", 
        youtubeKeywords: ["C# methods tutorial", "C# debugging in visual studio", "C# try catch explained"],
        parallelTrack: { 
            title: "SQL لتحليل البيانات (ترتيب وتصفية)",
            icon: 'sql',
            goals: ["ترتيب النتائج باستخدام ORDER BY", "استخدام DISTINCT لإزالة التكرار", "الدمج بين WHERE و ORDER BY"],
            lessons: ["ORDER BY (ASC, DESC)", "DISTINCT", "Combining WHERE and ORDER BY"],
            youtubeKeywords: ["sql order by tutorial", "sql distinct examples", "sql where and order by"],
            project: "كتابة استعلامات لاسترجاع بيانات من جدول منتجات وترتيبها حسب السعر، وإظهار القيم المميزة في عمود معين"
        },
         englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: play, study, listen, watch, speak, help, ask, answer, open, close, run, walk, read, write, think, build, test, deploy, fix, update", "القاعدة: استخدام 'a' و 'an' مع الأسماء المفردة. مثال: 'a book', 'an apple'."]
        },
        aiTools: []
    },
    { 
        phase: "تأسيس C#", week: 3, title: "التحكم في الإصدار مع Git", 
        goals: ["فهم أهمية التحكم في الإصدار", "إعداد Git و GitHub", "تنفيذ الأوامر الأساسية (clone, add, commit, push)"], 
        lessons: ["What is Version Control?", "Git & GitHub Setup", "Basic Git Commands", "Creating & Cloning Repositories", "Branching & Merging Basics"],
        project: "إنشاء مستودع جديد على GitHub لمشاريعك، إضافة مشروع الآلة الحاسبة من الأسبوع الأول، إجراء تغيير، وعمل commit و push لهذا التغيير.", 
        parallelTrack: { 
            title: "SQL لتحليل البيانات (دوال التجميع)",
            icon: 'sql',
            goals: ["استخدام دوال التجميع (COUNT, SUM, AVG, MAX, MIN)", "تجميع البيانات باستخدام GROUP BY"],
            lessons: ["Aggregate Functions (COUNT, SUM, AVG, MAX, MIN)", "GROUP BY Clause"],
            youtubeKeywords: ["sql aggregate functions", "sql group by tutorial", "sql count sum avg"],
            project: "تحليل بيانات مبيعات: حساب إجمالي المبيعات لكل منتج، متوسط سعر المنتجات، عدد العملاء في كل مدينة"
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: happy, sad, big, small, hot, cold, good, bad, easy, difficult, new, old, young, high, low, fast, slow, light, dark, heavy", "القاعدة: استخدام صفة قبل الاسم. مثال: 'a big house'."]
        },
        aiTools: []
    },
    { 
        phase: "تأسيس C#", week: 4, title: "مقدمة إلى OOP", 
        goals: ["فهم مفهوم البرمجة كائنية التوجه", "كتابة أول Class و Object", "التعرف على Constructors و 'this' keyword"], 
        lessons: ["Why OOP?", "Classes and Objects", "Fields and Methods", "Constructors", "The 'this' Keyword"], 
        project: "إنشاء Class بسيطة `Car` تحتوي على خصائص (مثل اللون، الموديل) وأفعال (مثل StartEngine, StopEngine). ثم إنشاء عدة objects من هذه الـ Class في برنامج Console.", 
        parallelTrack: { 
            title: "SQL لتحليل البيانات (فلترة المجموعات)",
            icon: 'sql',
            goals: ["فلترة المجموعات باستخدام HAVING", "الفروق بين WHERE و HAVING"],
            lessons: ["HAVING Clause", "Differences between WHERE and HAVING"],
            youtubeKeywords: ["sql having clause", "sql where vs having", "sql group by having"],
            project: "بناء على مشروع الأسبوع السابق، إضافة HAVING لتصفية المجموعات (إظهار المنتجات التي يزيد إجمالي مبيعاتها عن 1000)"
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: always, never, sometimes, often, usually, today, tomorrow, yesterday, now, then, here, there, in, on, at, with, for, from, to, of", "القاعدة: المفرد والجمع للأسماء ( بإضافة s). مثال: 'one book', 'two books'."]
        },
        aiTools: []
    },
     { 
        phase: "تأسيس C#", week: 5, title: "أركان الـ OOP الأساسية", 
        goals: ["تطبيق الوراثة (Inheritance)", "فهم تعدد الأشكال (Polymorphism)", "التعرف على التغليف (Encapsulation) باستخدام Access Modifiers"], 
        lessons: ["Inheritance", "Polymorphism (Method Overriding)", "Access Modifiers (public, private, protected)", "Encapsulation"], 
        parallelTrack: { 
            title: "SQL لتحليل البيانات (JOINs)",
            icon: 'sql',
            goals: ["فهم العلاقات بين الجداول", "استخدام INNER JOIN لدمج الجداول", "استخدام LEFT JOIN لدمج الجداول"],
            lessons: ["Table Relationships", "INNER JOIN", "LEFT JOIN"],
            youtubeKeywords: ["sql joins explained", "sql inner join tutorial", "sql left join examples"],
            project: "دمج جدول الطلبات مع جدول العملاء باستخدام INNER JOIN، ودمج جدول المنتجات مع جدول الفئات باستخدام LEFT JOIN"
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: I, you, he, she, it, we, they, my, your, our, his, her, its, their, me, him, us, them, this, that", "القاعدة: الضمائر الشخصية وضمائر الملكية البسيطة. مثال: 'I have my book'."]
        },
        aiTools: []
    },
     { 
        phase: "تأسيس C#", week: 6, title: "مفاهيم متقدمة في OOP", 
        goals: ["فهم الفرق بين Interface و Abstract Class", "استخدام Classes ثابتة وأعضاء ثابتة (Static)", "تطبيق مبدأ تعدد الأشكال باستخدام Interfaces"],
        lessons: ["Abstract Classes and Methods", "Interfaces", "Static Members and Classes", "Polymorphism with Interfaces"],
        project: "تطوير برنامج أشكال هندسة: إنشاء Abstract Class `Shape` مع دالة مجردة `CalculateArea`. إنشاء Classes فرعية `Circle` و `Rectangle` ترث منها وتطبق الدالة. ثم إنشاء Interface `IDrawable` وتطبيقه.",
        parallelTrack: { 
            title: "SQL لتحليل البيانات (استعلامات فرعية)",
            icon: 'sql',
            goals: ["كتابة استعلامات فرعية (Subqueries)", "استخدام IN مع الاستعلامات الفرعية", "استخدام EXISTS"],
            lessons: ["Subqueries", "IN with Subqueries", "EXISTS"],
            youtubeKeywords: ["sql subqueries tutorial", "sql in operator with subquery", "sql exists operator"],
            project: "كتابة استعلامات تستخدم Subqueries (إيجاد العملاء الذين لم يطلبوا أي طلب، أو المنتجات التي سعرها فوق المتوسط)"
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: one, two, three, four, five, six, seven, eight, nine, ten, first, second, third, last, next, number, count, total, sum, average", "القاعدة: استخدام 'There is' للمفرد و 'There are' للجمع. مثال: 'There is one car'."]
        },
        aiTools: []
    },
    { 
        phase: "تأسيس C#", week: 7, title: "Collections & LINQ", 
        goals: ["التعامل مع List, Dictionary", "استخدام LINQ للاستعلام عن Collections", "فهم Generics"], 
        lessons: ["Collections (List, Dictionary, HashSet)", "Introduction to Generics", "LINQ (Where, Select, OrderBy, GroupBy)", "Lambda Expressions"], 
        project: "برنامج Console لتحليل بيانات من ملف CSV: قراءة البيانات في `List<T>`، ثم استخدام LINQ للإجابة على أسئلة مثل (أعلى 5 منتجات مبيعًا، متوسط السعر، تجميع حسب الفئة).", 
        parallelTrack: {
            title: "SQL لتحليل البيانات (تعديل البيانات)",
            icon: 'sql',
            goals: ["إدراج بيانات جديدة باستخدام INSERT", "تعديل البيانات باستخدام UPDATE", "حذف البيانات باستخدام DELETE"],
            lessons: ["INSERT INTO", "UPDATE", "DELETE"],
            youtubeKeywords: ["sql insert into", "sql update statement", "sql delete statement"],
            project: "إنشاء جدول جديد وإدراج بيانات فيه، ثم تعديل بعض البيانات وحذف أخرى"
        },
         englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: red, green, blue, yellow, black, white, orange, purple, brown, pink, color, light, dark, bright, size, length, width, height, weight, large", "القاعدة: زمن المضارع البسيط. مثال: 'He works', 'She studies'."]
        },
        aiTools: []
    },
    { 
        phase: "تأسيس C#", week: 8, title: "Delegates, Events, Async & Files", 
        goals: ["فهم آلية عمل Delegates و Events", "استخدام async/await لتجنب تجميد الواجهة", "قراءة وكتابة البيانات من وإلى ملفات نصية"], 
        lessons: ["Delegates and Events", "Async/Await", "System.IO (File, Directory)", "Working with JSON (Newtonsoft.Json)"], 
        project: "برنامج لنسخ ملفات بشكل غير متزامن: اختيار مجلد مصدر ومجلد هدف، بدء النسخ مع إظهار شريط تقدم. استخدم Events للإبلاغ عن تقدم عملية النسخ.", 
        parallelTrack: {
            title: "SQL لتحليل البيانات (مراجعة شاملة)",
            icon: 'sql',
            goals: ["مراجعة جميع مفاهيم SQL الأساسية", "تطبيق جميع الدروس في مشروع متكامل"],
            lessons: ["Review: SELECT, WHERE, ORDER BY", "Review: Aggregate Functions & GROUP BY", "Review: JOINs & Subqueries", "Review: INSERT, UPDATE, DELETE"],
            youtubeKeywords: ["sql complete tutorial", "sql practice exercises", "sql real world examples"],
            project: "بناء قاعدة بيانات متكاملة لمتجر صغير وتنفيذ جميع عمليات CRUD واستعلامات التحليل"
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday, week, day, weekend, month, year, date, time, hour, minute, second, morning, evening, night", "القاعدة: نفي المضارع البسيط (don't/doesn't). مثال: 'I don't work on Sunday'."]
        },
        aiTools: []
    },
    
    // Phase 2: Desktop Development
    { 
        phase: "تطوير تطبيقات سطح المكتب", week: 9, title: "WinForms Basics", 
        goals: ["تصميم أول واجهة WinForms", "التعامل مع الأحداث مثل النقر على زر", "ربط البيانات بعنصر DataGridView"], 
        lessons: ["Forms, Controls", "Events, DataGridView, Data Binding", "Layouts, Input Validation"], 
        project: "تطبيق WinForms لإدارة جهات الاتصال: واجهة لإضافة، تعديل، حذف، والبحث عن جهات اتصال مع عرض البيانات في DataGridView.", 
        parallelTrack: {
            title: "SQL لتحليل البيانات (أساسيات)",
            icon: 'sql',
            goals: ["إتقان استعلامات SELECT و WHERE", "فهم الترتيب والترشيح (ORDER BY, TOP, DISTINCT)", "التعرف على دوال SQL الأساسية"],
            lessons: ["SELECT Statement", "WHERE Clause", "ORDER BY, TOP, DISTINCT", "Basic Functions (COUNT, SUM, AVG)"],
            youtubeKeywords: ["sql select statement", "sql where clause", "sql order by"],
            project: "كتابة استعلامات لاسترجاع: جميع العملاء من مدينة معينة، أعلى 5 منتجات سعراً، عدد الموظفين في الشركة."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: January, February, March, April, May, June, July, August, September, October, November, December, season, spring, summer, autumn, winter, holiday, new year, birthday", "القاعدة: زمن الماضي البسيط للأفعال المنتظمة ( بإضافة -ed). مثال: 'I worked yesterday'."]
        },
        aiTools: []
    },
    { 
        phase: "تطوير تطبيقات سطح المكتب", week: 10, title: "WinForms Advanced", 
        goals: ["بناء تطبيق متعدد النوافذ (MDI)", "إنشاء عناصر تحكم مخصصة (User Controls)", "التعامل مع مربعات الحوار (Dialogs)"], 
        lessons: ["MenuStrip, ToolStrip", "MDI Forms", "User Controls", "Dialogs"], 
        project: "بناء تطبيق MDI لإدارة متجر صغير: شاشة رئيسية تحتوي على قوائم، وشاشات فرعية (للعملاء، للمنتجات، للفواتير) تفتح داخلها.", 
        parallelTrack: {
            title: "SQL لتحليل البيانات (تجميع وربط)",
            icon: 'sql',
            goals: ["تجميع البيانات باستخدام GROUP BY", "فلترة المجموعات باستخدام HAVING", "ربط الجداول باستخدام JOINs"],
            lessons: ["JOIN (INNER, LEFT, RIGHT)", "Data Aggregation (GROUP BY)", "HAVING Clause"],
            youtubeKeywords: ["sql joins explained", "sql group by and having", "sql aggregation functions"],
            project: "كتابة استعلام يجمع بيانات المبيعات لتحديد العملاء الذين أنفقوا أكثر من 1000 دولار، واستعلام آخر يستخدم JOIN لعرض أسماء العملاء مع طلباتهم."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: question, idea, problem, solution, name, age, country, job, email, phone, address, city, state, zip, password, username, login, logout, register, profile", "القاعدة: طرح أسئلة بـ 'Do/Does'. مثال: 'Do you work here?'."]
        },
        aiTools: []
    },

    // Phase 3: Database
    { 
        phase: "قواعد البيانات", week: 11, title: "أساسيات SQL", 
        goals: ["تصميم قاعدة بيانات بسيطة", "كتابة استعلامات INSERT, UPDATE, DELETE", "فهم المفاتيح الأساسية والأجنبية"], 
        lessons: ["DDL (CREATE TABLE)", "DML (INSERT, UPDATE, DELETE)", "Primary & Foreign Keys", "Database Normalization (1NF, 2NF)"], 
        project: "تصميم وبناء قاعدة بيانات SQL Server لمكتبة (كتب، مؤلفون، أعضاء، استعارات)، وتنفيذ عمليات CRUD عليها باستخدام استعلامات مباشرة.", 
        youtubeKeywords: ["SQL basics for beginners", "SQL server tutorial", "SQL DDL DML"],
        parallelTrack: {
            title: "SQL لتحليل البيانات (استعلامات متقدمة)",
            icon: 'sql',
            goals: ["كتابة استعلامات فرعية (Subqueries)", "فهم Common Table Expressions (CTEs)", "استخدام جمل CASE للتحليل الشرطي"],
            lessons: ["Subqueries and Derived Tables", "Common Table Expressions (CTEs)", "Conditional Logic with CASE"],
            youtubeKeywords: ["sql subqueries tutorial", "sql ctes explained", "sql case statement"],
            project: "كتابة استعلام يستخدم Subquery لإيجاد المنتجات التي لم يتم بيعها أبدًا. واستعلام آخر يصنف العملاء إلى فئات (ذهبي، فضي، برونزي) باستخدام CASE."
        },
         englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: answer, issue, report, team, manager, client, customer, meeting, email, deadline, task, goal, plan, status, update, feedback, document, file, folder, link", "القاعدة: نفي الماضي البسيط (didn't). مثال: 'She didn't watch the movie'."]
        },
        aiTools: []
    },
    { 
        phase: "قواعد البيانات", week: 12, title: "SQL Advanced", 
        goals: ["كتابة أول Stored Procedure", "فهم فوائد Indexes", "التعرف على Views و Triggers"], 
        lessons: ["Stored Procedures", "Indexes", "Views", "Triggers (Introduction)"], 
        project: "تحويل عمليات CRUD في مشروع المكتبة لتتم من خلال Stored Procedures. أضف Index لجدول الكتب لتحسين سرعة البحث بالاسم.", 
        youtubeKeywords: ["SQL stored procedure tutorial", "Database normalization explained", "SQL indexes tutorial"],
        parallelTrack: {
            title: "SQL لتحليل البيانات (Window Functions)",
            icon: 'sql',
            goals: ["استخدام دوال الترتيب (Window Functions)", "فهم خطط التنفيذ (Execution Plans) للاستعلامات", "تحليل أداء الاستعلامات"],
            lessons: ["Window Functions (ROW_NUMBER, RANK, LEAD, LAG)", "Query Execution Plans", "Query Optimization Techniques"],
            youtubeKeywords: ["sql window functions tutorial", "sql execution plan analysis", "sql query optimization"],
            project: "كتابة استعلام يرجع قائمة بالموظفين الأعلى راتباً في كل قسم باستخدام (Window Functions). ثم تحليل Execution Plan لاستعلام Join معقد وتحسينه."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: family, mother, father, brother, sister, son, daughter, home, school, company, university, student, teacher, class, lesson, homework, exam, grade, subject, course", "القاعدة: طرح أسئلة في الماضي البسيط (Did...?). مثال: 'Did you finish?'."]
        },
        aiTools: []
    },

    // Phase 4: Data Access (Now Includes SQL W5 & W6 Parallel)
    { 
        phase: "الوصول للبيانات", week: 13, title: "ADO.NET", 
        goals: ["الاتصال بقاعدة بيانات SQL Server من C#", "تنفيذ عمليات CRUD باستخدام SqlCommand", "قراءة البيانات باستخدام SqlDataReader"], 
        lessons: ["SqlConnection, SqlCommand", "SqlDataReader, DataSet, DataTable", "CRUD operations"], 
        project: "ربط تطبيق WinForms لإدارة جهات الاتصال بقاعدة بيانات SQL Server باستخدام ADO.NET لتنفيذ جميع عمليات CRUD.", 
        youtubeKeywords: ["C# ADO.NET tutorial", "C# connect to SQL server", "CRUD operations C# ADO.NET"],
        parallelTrack: {
            title: "SQL لتحليل البيانات (إجراءات متقدمة)",
            icon: 'sql',
            goals: ["كتابة Stored Procedures متقدمة لعمليات التحليل", "فهم Transaction Management لضمان سلامة البيانات", "تطبيق Best practices عند كتابة T-SQL"],
            lessons: ["Stored Procedures with parameters", "TRY/CATCH in SPs for error handling", "Transactions (BEGIN, COMMIT, ROLLBACK)", "Best practices for T-SQL (Aliasing, Schema prefixes)"],
            youtubeKeywords: ["sql transactions tutorial", "sql stored procedures advanced", "sql t-sql best practices"],
            project: "تحويل عمليات EF Core (W14) إلى Stored Procedures وتنفيذها داخل Transaction. (Alignment W13: ADO.NET)"
        },
         englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: what, where, when, who, why, how, which, this, that, these, those, here, there, next to, between, behind, under, over, above, below", "القاعدة: زمن المستقبل البسيط (will). مثال: 'I will call you tomorrow'."]
        },
        aiTools: []
    },
    { 
        phase: "الوصول للبيانات", week: 14, title: "Entity Framework Core", 
        goals: ["إنشاء DbContext و DbSet", "استخدام LINQ to Entities للاستعلام عن البيانات", "تطبيق Code-First Migrations"], 
        lessons: ["DbContext, DbSet", "LINQ to Entities", "Code-First Migrations", "Relationships"], 
        project: "إعادة بناء طبقة الوصول للبيانات في تطبيق جهات الاتصال باستخدام EF Core (Code-First)، وإنشاء قاعدة البيانات تلقائيًا عبر Migrations.", 
        youtubeKeywords: ["C# Entity Framework Core tutorial", "EF Core code first migrations", "LINQ to Entities C#"],
        parallelTrack: {
            title: "SQL لتحليل البيانات (تكامل البيانات)",
            icon: 'sql',
            goals: ["استيراد وتصدير البيانات من/إلى SQL Server", "فهم مفهوم ETL البسيط باستخدام SQL", "التعرف على SSIS/Azure Data Factory (مقدمة)"],
            lessons: ["BULK INSERT for mass data loading", "Linked Servers (Introduction)", "Data Import/Export Wizard", "Introduction to ETL concepts"],
            youtubeKeywords: ["sql bulk insert tutorial", "sql linked servers explained", "sql etl basics"],
            project: "استيراد ملف CSV كبير إلى قاعدة البيانات بسرعة باستخدام BULK INSERT، ثم كتابة View لدمج البيانات الجديدة من جدولين."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: can, could, will, would, shall, should, may, might, must, have to, able to, need to, want to, like to, love to, hate to, try to, start to, stop to, forget to", "القاعدة: حروف الجر للمكان. مثال: 'The cat is under the table'."]
        },
        aiTools: []
    },

    // Phase 5: Software Architecture (Now Includes Power BI W1, W2 Parallel)
    { 
        phase: "هندسة البرمجيات", week: 15, title: "Layered Architecture", 
        goals: ["فهم أهمية فصل الاهتمامات (Separation of Concerns)", "تصميم وتطبيق بنية ثلاثية الطبقات (UI, BLL, DAL)", "إعادة هيكلة مشروعك ليتبع البنية الطبقية"], 
        lessons: ["N-Tier / Layered Architecture Concepts", "Data Access Layer (DAL)", "Business Logic Layer (BLL)", "Presentation Layer (UI)"], 
        project: "إعادة هيكلة مشروع EF Core ليتبع بنية ثلاثية الطبقات، بحيث تكون واجهة WinForms هي طبقة العرض، ويتم وضع منطق العمل في BLL، ويكون EF Core DbContext في DAL.", 
        youtubeKeywords: ["C# layered architecture", "n-tier architecture c#", "separation of concerns"],
        parallelTrack: {
            title: "Power BI Basics & Query Editor (PBI W1)",
            icon: 'powerbi',
            goals: ["التعرف على واجهة Power BI Desktop", "استيراد البيانات من مصادر متعددة (Excel, SQL)", "استخدام Power Query Editor لتنظيف وتحويل البيانات"],
            lessons: ["Power BI Desktop Introduction", "Getting Data (Connectors)", "Data Transformation with Power Query"],
            youtubeKeywords: ["power bi for beginners", "power bi get data from sql", "power query in power bi tutorial"],
            project: "استيراد بيانات من SQL ومن ملف Excel إلى Power BI، ثم استخدام Power Query لتنظيفها (إزالة الأخطاء، تغيير أنواع البيانات، دمج الأعمدة)."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: fast, slow, quickly, slowly, careful, carefully, loud, loudly, quiet, quietly, good, well, bad, badly, hard, hardly, late, lately, early, easy", "القاعدة: الأفعال المساعدة (Modal Verbs). مثال: 'I can speak English'."]
        },
        aiTools: []
    },
    { 
        phase: "هندسة البرمجيات", week: 16, title: "مبادئ SOLID", 
        goals: ["فهم كل مبدأ من مبادئ SOLID الخمسة", "التعرف على أمثلة عملية لكل مبدأ", "تحليل كود موجود وتحديد انتهاكات SOLID"], 
        lessons: ["Single Responsibility Principle (SRP)", "Open/Closed Principle (OCP)", "Liskov Substitution Principle (LSP)", "Interface Segregation Principle (ISP)", "Dependency Inversion Principle (DIP)"], 
        project: "مراجعة مشروعك الطبقي وتحسينه لتطبيق مبدأين على الأقل من مبادئ SOLID (مثل SRP و DIP).", 
        youtubeKeywords: ["SOLID principles explained", "SOLID principles C# with examples", "Robert C Martin SOLID"],
        parallelTrack: {
            title: "Power BI Data Modeling & DAX Essentials (PBI W2)",
            icon: 'powerbi',
            goals: ["بناء نموذج بيانات (Data Model) وإنشاء علاقات", "فهم مبادئ DAX", "كتابة مقاييس (Measures) وأعمدة محسوبة (Calculated Columns)"],
            lessons: ["Data Modeling and Relationships", "Introduction to DAX", "Measures vs. Calculated Columns"],
            youtubeKeywords: ["power bi data modeling", "dax in power bi tutorial", "power bi measures vs calculated columns"],
            project: "إنشاء نموذج بيانات في Power BI بربط جدول المبيعات بجداول (المنتجات، العملاء، التواريخ)، ثم كتابة مقاييس DAX لحساب (إجمالي الربح، نسبة النمو السنوي للمبيعات)."
        },
         englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: bigger than, smaller than, faster than, more expensive than, the biggest, the smallest, the best, the worst, good, better, bad, worse, many, more, much, less, little, few, most, least", "القاعدة: الفرق بين الصفة (Adjective) والحال (Adverb). مثال: 'He is a slow driver. He drives slowly.'."]
        },
        aiTools: []
    },
    { 
        phase: "هندسة البرمجيات", week: 17, title: "أنماط التصميم و DI", 
        goals: ["تطبيق نمط Repository و Unit of Work", "فهم وتطبيق حقن التبعية (Dependency Injection)", "إعداد حاوية DI بسيطة"], 
        lessons: ["Repository Pattern", "Unit of Work Pattern", "Inversion of Control (IoC)", "Dependency Injection (DI)", "DI Containers (e.g., Microsoft.Extensions.DependencyInjection)"], 
        project: "تطبيق نمط Repository و Unit of Work في طبقة DAL لمشروعك. ثم استخدام DI Container لحقن الـ Repositories في طبقة الـ BLL.", 
        youtubeKeywords: ["Repository pattern C#", "Unit of Work C#", "C# dependency injection tutorial"],
         parallelTrack: {
            title: "Power BI Interactive Reports (PBI W3)",
            icon: 'powerbi',
            goals: ["إنشاء تقارير تفاعلية باستخدام مرئيات مختلفة", "تنسيق المرئيات وتخصيصها", "استخدام الفلاتر والمقاطع (Filters & Slicers)"],
            lessons: ["Creating Reports and Visualizations", "Formatting Visuals", "Filters and Slicers"],
            youtubeKeywords: ["power bi reports tutorial", "power bi visualization types", "power bi filters and slicers"],
            project: "بناء تقرير من صفحتين في Power BI: الصفحة الأولى تعرض مؤشرات الأداء الرئيسية (KPIs) والمبيعات عبر الزمن، والصفحة الثانية تحليل جغرافي للمبيعات على الخريطة."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: because, so, but, and, or, if, when, while, before, after, since, until, unless, although, though, as, also, too, however, therefore", "القاعدة: المقارنة والتفضيل (Comparatives & Superlatives). مثال: 'My car is faster than your car'."]
        },
        aiTools: []
    },
    { 
        phase: "هندسة البرمجيات", week: 18, title: "Logging & Unit Testing", 
        goals: ["إضافة نظام تسجيل (Logging) للمشروع", "كتابة أول Unit Test", "فهم مبدأ Mocking"], 
        lessons: ["Logging (NLog/Serilog)", "Unit Testing (MSTest/NUnit)", "Mocking (Moq)", "Test Driven Development (TDD) Introduction"], 
        project: "إضافة Serilog لتسجيل الأحداث الهامة (مثل الأخطاء) في مشروعك. كتابة Unit Tests لخدمات طبقة BLL باستخدام Moq لعمل Mock للـ Repositories.", 
        youtubeKeywords: ["Serilog C# tutorial", "C# unit testing with NUnit", "Moq tutorial C#"],
        parallelTrack: {
            title: "Power BI Advanced DAX & Time Intelligence (PBI W4)",
            icon: 'powerbi',
            goals: ["تطبيق دوال DAX معقدة (CALCULATE, ALL)", "فهم Time Intelligence (التحليل الزمني)", "كتابة مقاييس للمقارنة مع الفترات الزمنية السابقة"],
            lessons: ["Advanced DAX (CALCULATE, ALL, FILTER)", "Time Intelligence Functions (DATESYTD, SAMEPERIODLASTYEAR)", "Applying Context Transition"],
            youtubeKeywords: ["power bi advanced dax calculate", "power bi time intelligence functions", "dax context transition explained"],
            project: "تحسين التقارير السابقة بإضافة مقاييس DAX لحساب (المبيعات لنفس الفترة من العام الماضي، فرق المبيعات، ونسبة التغير)."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: write, read, listen, speak, learn, teach, understand, explain, review, practice, agree, disagree, suggest, recommend, accept, reject, approve, deny, confirm, cancel", "القاعدة: أدوات الربط (Conjunctions) لربط الجمل. مثال: 'I was tired, so I went to sleep'."]
        },
        aiTools: []
    },
    
    // Phase 6: Professional UI (Now Includes Power BI W5, W6 Parallel)
    { 
        phase: "واجهات احترافية", week: 19, title: "DevExpress Basics", 
        goals: ["عرض البيانات في GridControl", "تصميم واجهة إدخال باستخدام LayoutControl", "استخدام LookUpEdit للبيانات المرتبطة"], 
        lessons: ["GridControl, LayoutControl", "NavigationPane, LookUpEdit", "Data Editors"], 
        project: "تصميم شاشة لإدارة الموظفين باستخدام DevExpress: عرض الموظفين في GridControl، واستخدام LayoutControl لتصميم فورم الإدخال، و LookUpEdit لاختيار القسم.", 
        parallelTrack: {
            title: "Power BI Storytelling (PBI W5)",
            icon: 'powerbi',
            goals: ["استخدام مرئيات مخصصة من AppSource", "إنشاء صفحات تلميحات (Tooltips) تفاعلية", "استخدام الإشارات المرجعية (Bookmarks) لسرد القصص بالبيانات"],
            lessons: ["Custom Visuals", "Report Page Tooltips", "Bookmarks and Storytelling"],
            youtubeKeywords: ["power bi custom visuals", "power bi report tooltips", "power bi bookmarks storytelling"],
            project: "تحسين تقريرك السابق بإضافة مرئي مخصص، وإنشاء صفحة تلميحات تظهر تفاصيل إضافية عند المرور على رسم بياني، واستخدام الإشارات المرجعية لإنشاء عرض تقديمي."
        },
         englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: was, were, go, went, see, saw, do, did, make, made, get, got, take, took, come, came, find, found, know, knew", "القاعدة: زمن المضارع المستمر (Present Continuous). مثال: 'I am learning English'."]
        },
        aiTools: []
    },
    { 
        phase: "واجهات احترافية", week: 20, title: "DevExpress Advanced", 
        goals: ["بناء قائمة رئيسية باستخدام Ribbon Control", "تصميم أول تقرير باستخدام XtraReports", "استخدام TreeList لعرض البيانات الهرمية"], 
        lessons: ["Ribbon Control", "Navigation Controls", "TreeList", "DevExpress Reports"], 
        project: "تطوير تطبيق إدارة الموظفين: إضافة Ribbon Control كقائمة رئيسية، وإنشاء تقرير XtraReport لطباعة بطاقة موظف، واستخدام TreeList لعرض الهيكل الإداري للشركة.", 
        parallelTrack: {
            title: "Power BI Deployment & Governance (PBI W6)",
            icon: 'powerbi',
            goals: ["نشر التقارير إلى Power BI Service", "تطبيق أمان على مستوى الصف (Row-Level Security)", "جدولة تحديث البيانات تلقائياً"],
            lessons: ["Publishing to Power BI Service", "Creating Dashboards", "Row-Level Security (RLS)", "Scheduled Refresh"],
            youtubeKeywords: ["power bi row level security", "power bi workspaces tutorial", "power bi scheduled refresh"],
            project: "نشر التقرير الذي أنشأته إلى Power BI Service، ثم تطبيق RLS على نموذج البيانات وجدولة تحديثه اليومي."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: have, has, had, be, am, is, are, was, were, been, say, said, tell, told, ask, asked, need, needed, feel, felt", "القاعدة: الأفعال الشاذة في الماضي البسيط (Irregular Verbs). مثال: 'I went to the store'."]
        },
        aiTools: []
    },

    // Phase 7: Advanced Integration (Now Includes Python W1, W2 Parallel)
    { 
        phase: "تكامل متقدم", week: 21, title: "Excel & Attachments", 
        goals: ["تصدير البيانات من GridControl إلى ملف Excel", "قراءة بيانات من ملف Excel", "تخزين الملفات والصور في قاعدة البيانات"], 
        lessons: ["ClosedXML for Excel", "Reading from Excel", "Storing BLOBs in SQL Server"], 
        project: "إضافة ميزة في تطبيق DevExpress لتصدير بيانات الموظفين في GridControl إلى ملف Excel، وميزة أخرى لحفظ صورة الموظف في قاعدة البيانات.", 
        youtubeKeywords: ["C# ClosedXML tutorial", "Export to Excel C#", "Store file in SQL server C#"],
         parallelTrack: {
            title: "Python & NumPy Basics (Python W1)",
            icon: 'python',
            goals: ["تثبيت Python وإعداد بيئة العمل (VS Code)", "فهم أساسيات Python (متغيرات، حلقات، دوال)", "مقدمة إلى مكتبة NumPy للعمليات الرياضية"],
            lessons: ["Python Environment Setup", "Python Fundamentals", "NumPy Arrays and Operations"],
            youtubeKeywords: ["python for data analysis setup", "python basics tutorial", "numpy tutorial for beginners"],
            project: "كتابة سكربت Python يقوم بإنشاء مصفوفة NumPy تحتوي على درجات حرارة، ثم حساب (المتوسط، أعلى درجة، أقل درجة) باستخدام دوال NumPy."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: buy, bought, sell, sold, pay, paid, cost, price, money, cash, credit, card, bank, account, invoice, receipt, budget, expense, profit, loss", "القاعدة: زمن المضارع التام (Present Perfect). مثال: 'I have finished my work'."]
        },
        aiTools: []
    },
    { 
        phase: "تكامل متقدم", week: 22, title: "الأمن والصلاحيات", 
        goals: ["بناء شاشة تسجيل دخول فعالة", "تشفير كلمات المرور قبل حفظها", "تطبيق نظام صلاحيات قائم على الأدوار (RBAC)"], 
        lessons: ["Authentication vs. Authorization", "Role-Based Access Control (RBAC)", "Password Hashing & Salting"], 
        project: "إضافة نظام تسجيل دخول وصلاحيات لتطبيقك: إنشاء جدول للمستخدمين والأدوار، تشفير كلمات المرور، وإخفاء/إظهار الأزرار في Ribbon Control بناءً على صلاحيات المستخدم.", 
        youtubeKeywords: ["C# authentication tutorial", "Password hashing C#", "Role based access control C#"],
         parallelTrack: {
            title: "Pandas: DataFrames & Cleaning (Python W2)",
            icon: 'python',
            goals: ["استخدام مكتبة Pandas لقراءة البيانات (CSV, Excel)", "تنظيف ومعالجة البيانات باستخدام DataFrames", "إجراء عمليات الفلترة والتجميع"],
            lessons: ["Intro to Pandas DataFrames", "Data Cleaning with Pandas", "Filtering and Grouping Data"],
            youtubeKeywords: ["pandas tutorial python", "pandas dataframe explained", "pandas data cleaning"],
            project: "استخدام Pandas لقراءة ملف CSV لبيانات مبيعات، ثم تنظيفه (حذف الصفوف الفارغة، تصحيح أنواع البيانات)، وحساب إجمالي المبيعات لكل مدينة."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: meeting, email, report, presentation, deadline, project, team, manager, client, customer, user, admin, server, database, network, security, cloud, backup, restore, access", "القاعدة: استخدام 'going to' للتعبير عن المستقبل. مثال: 'I am going to start a new project'."]
        },
        aiTools: []
    },
    
    // Phase 8: Modern Development (Now Includes Python W3-W6 Parallel)
    { 
        phase: "التطوير الحديث والـ APIs", week: 23, title: "مفاهيم الويب و HTTP", 
        goals: ["فهم نموذج العميل والخادم (Client-Server Model)", "التعرف على بروتوكول HTTP وأفعاله (Verbs)", "فهم رموز استجابة HTTP (e.g., 200, 404, 500)"],
        lessons: ["How the Web Works", "Client-Server Architecture", "HTTP/HTTPS", "HTTP Request/Response cycle", "HTTP Verbs & Status Codes"], 
        project: "استخدام أداة مثل Postman أو cURL لإرسال طلبات HTTP (GET, POST) إلى API عام (مثل JSONPlaceholder) وتحليل الاستجابة.", 
        youtubeKeywords: ["how http works", "http request response cycle", "rest api concepts for beginners"],
        parallelTrack: {
            title: "Data Visualization with Python (Python W3)",
            icon: 'python',
            goals: ["إنشاء رسوم بيانية أساسية باستخدام Matplotlib", "استخدام Seaborn لإنشاء رسوم بيانية إحصائية متقدمة", "تخصيص الرسوم البيانية (عناوين، ألوان)"],
            lessons: ["Data Visualization with Matplotlib", "Statistical Plotting with Seaborn", "Customizing Plots"],
            youtubeKeywords: ["matplotlib tutorial python", "seaborn tutorial", "python data visualization"],
            project: "باستخدام Matplotlib و Seaborn، قم بإنشاء رسم بياني خطي لعرض تطور المبيعات الشهرية، ورسم بياني شريطي لمقارنة المبيعات بين المدن."
        },
         englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: problem, issue, error, bug, solution, fix, help, support, question, feedback, request, response, success, failure, pending, processing, complete, incomplete, valid, invalid", "القاعدة: الجملة الشرطية الأولى (First Conditional). مثال: 'If I have time, I will help you'."]
        },
        aiTools: []
    },
    { 
        phase: "التطوير الحديث والـ APIs", week: 24, title: "مقدمة إلى ASP.NET Core API", 
        goals: ["فهم مفاهيم REST APIs", "بناء أول Controller و Endpoint", "اختبار ה-API باستخدام Postman/Swagger"], 
        lessons: ["REST APIs Basics", "ASP.NET Core Web API", "HTTP Verbs (GET, POST, PUT, DELETE)"], 
        project: "بناء Web API بسيط باستخدام ASP.NET Core يقوم بتوفير عمليات CRUD لبيانات الموظفين، واختباره باستخدام Swagger.", 
        youtubeKeywords: ["ASP.NET Core Web API tutorial for beginners", "What is REST API", "Swagger ASP.NET Core"],
        parallelTrack: {
            title: "Intro to Machine Learning (Regression) (Python W4)",
            icon: 'python',
            goals: ["فهم المفاهيم الأساسية لتعلم الآلة (Supervised vs Unsupervised)", "بناء أول نموذج انحدار خطي (Linear Regression)", "تقييم أداء النموذج"],
            lessons: ["Introduction to Machine Learning", "Linear Regression with Scikit-learn", "Model Evaluation"],
            youtubeKeywords: ["machine learning for beginners", "scikit-learn linear regression", "python machine learning tutorial"],
            project: "استخدام Scikit-learn لبناء نموذج انحدار خطي بسيط يتنبأ بسعر منزل بناءً على مساحته، ثم تقييم دقة النموذج."
        },
         englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: important, necessary, essential, useful, helpful, difficult, challenging, simple, clear, confusing, good, bad, better, worse, best, worst, some, any, no, every", "القاعدة: استخدام 'some' و 'any'. مثال: 'I have some questions. I don't have any answers.'."]
        },
        aiTools: []
    },
    { 
        phase: "التطوير الحديث والـ APIs", week: 25, title: "ربط سطح المكتب بالـ APIs", 
        goals: ["إرسال طلبات GET و POST من تطبيق WinForms", "التعامل مع بيانات JSON الواردة من ה-API", "ربط تطبيقك بالـ API الذي بنيته"], 
        lessons: ["HttpClient Class", "JSON.NET Library", "Consuming REST APIs"], 
        project: "تعديل تطبيق WinForms لإدارة الموظفين بحيث يقرأ ويكتب البيانات من خلال ה-API الذي بنيته في الأسبوع السابق بدلاً من الاتصال المباشر بقاعدة البيانات.", 
        youtubeKeywords: ["C# HttpClient tutorial", "C# consume REST API", "Json.NET tutorial"],
        parallelTrack: {
            title: "Machine Learning: Classification (Python W5)",
            icon: 'python',
            goals: ["بناء وتدريب نماذج التصنيف (Classification)", "فهم مصفوفة الارتباك (Confusion Matrix)", "تقييم دقة نماذج التصنيف"],
            lessons: ["Classification Models (Logistic Regression, KNN)", "Confusion Matrix", "Accuracy, Precision, Recall"],
            youtubeKeywords: ["scikit-learn classification tutorial", "logistic regression python", "confusion matrix explained"],
            project: "بناء نموذج يتنبأ بما إذا كان العميل سيترك الشركة (Churn) أم لا، بناءً على بيانات تاريخية، وتقييم دقته."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: website, application, software, hardware, network, database, server, client, user, admin, desktop, mobile, frontend, backend, fullstack, developer, engineer, analyst, designer, specialist", "القاعدة: استخدام 'much' و 'many'. مثال: 'How much time? How many files?'."]
        },
        aiTools: []
    },
    { 
        phase: "التطوير الحديث والـ APIs", week: 26, title: "تأمين API و Versioning", 
        goals: ["تأمين الـ API باستخدام JWT", "تطبيق Versioning على الـ API", "فهم مبادئ Cross-Origin Resource Sharing (CORS)"], 
        lessons: ["JWT Authentication", "API Versioning", "CORS policy"], 
        project: "إضافة نظام مصادقة JWT إلى ה-API الخاص بك، وإنشاء نسختين من endpoint واحد (v1, v2) لتطبيق الـ versioning.", 
        youtubeKeywords: ["asp.net core jwt authentication", "api versioning asp.net core", "cors explained"],
        parallelTrack: {
            title: "Unsupervised Learning (Clustering) (Python W6)",
            icon: 'python',
            goals: ["فهم التعلم غير الخاضع للإشراف (Unsupervised Learning)", "تطبيق خوارزمية K-Means للتجميع", "تحليل وتفسير النتائج"],
            lessons: ["Unsupervised Learning Concepts", "Clustering with K-Means", "Elbow Method for finding K", "Interpreting Clusters"],
            youtubeKeywords: ["k-means clustering python scikit-learn", "unsupervised learning explained", "elbow method python"],
            project: "استخدام K-Means لتصنيف العملاء إلى مجموعات مختلفة (Clusters) بناءً على سلوكهم الشرائي."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: first, second, third, next, then, after that, finally, in conclusion, for example, for instance, in addition, furthermore, moreover, however, on the other hand, in contrast, therefore, as a result, consequently, hence", "القاعدة: كلمات الترتيب (Sequencing words) لسرد الأحداث. مثال: 'First, open the file. Then, edit the text.'"]
        },
        aiTools: []
    },
    
    // Phase 9: Deployment & DevOps (Now Includes Python W7-W10 Parallel)
    { phase: "النشر و DevOps", week: 27, title: "Docker للحاويات", goals: ["فهم الفرق بين الحاويات والـ VMs", "كتابة Dockerfile لتطبيق C#", "بناء وتشغيل صورة (Image) للتطبيق"], lessons: ["Containers Introduction", "Docker vs. VMs", "Dockerfile for .NET", "Docker Compose"], project: "كتابة Dockerfile لمشروع ה-API الخاص بك، ثم بناء صورة Docker وتشغيلها كحاوية على جهازك المحلي.", youtubeKeywords: ["Docker for beginners", "Dockerize .NET application", "Docker compose tutorial"],
        parallelTrack: {
            title: "Web Scraping & Data Acquisition (Python W7)",
            icon: 'python',
            goals: ["فهم أساسيات سحب البيانات من الويب (Web Scraping)", "استخدام مكتبتي Requests و BeautifulSoup", "استخراج بيانات منظمة من صفحة HTML"],
            lessons: ["Web Scraping Basics", "Python Requests Library", "Parsing HTML with BeautifulSoup", "Extracting Data"],
            youtubeKeywords: ["python web scraping tutorial", "beautifulsoup python tutorial", "python requests library"],
            project: "كتابة سكربت Python لسحب عناوين الأخبار من موقع إخباري وطباعتها في الـ Console."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: agree, disagree, opinion, view, point, idea, suggestion, recommendation, feedback, comment, approve, reject, neutral, positive, negative, constructive, critical, proposal, argument, debate", "القاعدة: كيفية التعبير عن الرأي. مثال: 'In my opinion, this is the best solution'."]
        },
        aiTools: []
    },
    { phase: "النشر و DevOps", week: 28, title: "CI/CD مع GitHub Actions", goals: ["فهم مفهوم CI/CD", "إنشاء أول Workflow في GitHub Actions", "أتمتة بناء ونشر صورة Docker"], lessons: ["CI/CD Concepts", "GitHub Actions Workflows", "Automating Docker builds"], project: "إنشاء Workflow على GitHub Actions يقوم تلقائيًا ببناء واختبار ونشر صورة Docker لمشروع ה-API إلى Docker Hub عند كل push إلى الـ main branch.", youtubeKeywords: ["GitHub Actions tutorial", "CI/CD with GitHub Actions", "GitHub Actions for .NET"],
         parallelTrack: {
            title: "Building REST APIs with Python (Flask) (Python W8)",
            icon: 'python',
            goals: ["فهم أساسيات REST APIs", "بناء API بسيط باستخدام Flask", "إنشاء Endpoints (GET, POST)"],
            lessons: ["REST API Concepts", "Introduction to Flask", "Creating Routes (Endpoints)", "Handling GET & POST Requests"],
            youtubeKeywords: ["python flask tutorial for beginners", "flask rest api tutorial", "python build api"],
            project: "بناء API بسيط باستخدام Flask يوفر Endpoints لإضافة وقراءة قائمة مهام (To-Do List)."
        },
         englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: goal, objective, task, milestone, deadline, progress, status, update, issue, risk, budget, schedule, resource, scope, requirement, specification, design, development, testing, deployment", "القاعدة: زمن الماضي المستمر (Past Continuous). مثال: 'I was working when you called'."]
        },
        aiTools: []
    },
     { phase: "النشر و DevOps", week: 29, title: "مقدمة إلى النشر على السحابة (Azure)", goals: ["فهم أساسيات الحوسبة السحابية", "إنشاء حساب Azure مجاني", "نشر API على Azure App Service"], lessons: ["Cloud Computing Basics (IaaS, PaaS, SaaS)", "Azure Portal Introduction", "Deploying to Azure App Service"], project: "نشر ה-API الذي قمت ببنائه وعمل Dockerize له على خدمة Azure App Service وجعله متاحاً على الإنترنت.", youtubeKeywords: ["what is cloud computing", "azure for beginners", "deploy .net core api to azure app service"],
        parallelTrack: {
            title: "Python Deployment & Containers (Python W9)",
            icon: 'python',
            goals: ["كتابة Dockerfile لتطبيق Python/Flask", "فهم متطلبات نشر تطبيقات الـ AI على السحابة (Azure)", "تنظيم متطلبات التبعية (requirements.txt) بشكل احترافي"],
            lessons: ["Dockerfile for Python/Flask", "Containerization best practices", "Introduction to cloud deployment for ML models (Azure ML/App Service)"],
            youtubeKeywords: ["dockerize python flask app", "azure deployment for python", "containerize ml model python"],
            project: "كتابة Dockerfile لـ API Flask وبنائه، ثم نشره كحاوية على جهازك المحلي."
        },
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: efficient, performant, optimized, slow, fast, resource, memory, CPU, analysis, profile, latency, throughput, benchmark, scalable, reliable, available, secure, robust, stable, maintainable", "القاعدة: الجملة الشرطية الثانية (Second Conditional). مثال: 'If I had more time, I would improve the code'."]
        },
        aiTools: []
    },
    { phase: "النشر و DevOps", week: 30, title: "إنشاء برنامج التثبيت (Installer)", goals: ["إنشاء ملف MSI باستخدام Visual Studio", "إضافة اختصار للتطبيق على سطح المكتب", "تحديد المتطلبات المسبقة للتثبيت"], lessons: ["MSI Installers", "Visual Studio Installer Projects", "Prerequisites configuration"], project: "إنشاء ملف تثبيت (Setup.exe/MSI) لتطبيق WinForms النهائي باستخدام Visual Studio Installer، بحيث يمكن تثبيته بسهولة على أي جهاز Windows.", youtubeKeywords: ["Visual Studio Installer Project tutorial", "Create MSI installer C#", "WiX toolset tutorial"],
         parallelTrack: {
            title: "Async Python & Performance (Python W10)",
            icon: 'python',
            goals: ["فهم مبادئ Async/Await في Python", "تحسين أداء سكربتات تحليل البيانات (Profiling)", "التعامل مع العمليات المتوازية في Python"],
            lessons: ["Async/Await in Python (Basics)", "The asyncio library", "Performance Profiling in Python (e.g., cProfile)"],
            youtubeKeywords: ["asyncio python tutorial", "python performance profiling", "async python explained"],
            project: "أعد كتابة سكربت Web Scraping (W27) ليستخدم AsyncIO لتحسين سرعة سحب البيانات."
        },
         englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: function, method, parameter, argument, return, value, type, object, class, interface, inheritance, polymorphism, encapsulation, abstraction, module, library, framework, package, dependency, repository", "القاعدة: زمن الماضي التام (Past Perfect). مثال: 'I had already finished when he arrived'."]
        },
        aiTools: []
    },
    
    // Phase 10: Final Project (No Parallel Track)
    { phase: "مشروع التخرج", week: 31, title: "المرحلة 1: التخطيط والتحليل", summary: "تحويل فكرة مجردة إلى خطة عمل ملموسة تشمل تصميم قاعدة البيانات والهيكل المعماري.", goals: ["تحديد متطلبات المشروع بشكل كامل", "رسم مخطط ERD لقاعدة البيانات", "تخطيط الواجهات الرئيسية (Wireframes)"], lessons: ["Requirement Gathering", "ERD Design", "Wireframing"], project: "كتابة وثيقة متطلبات كاملة لمشروعك (ERP صغير، نظام إدارة عيادة، ...)، ورسم مخطط ERD، وتصميم الواجهات الرئيسية على ورق أو باستخدام أداة مثل Balsamiq.",
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: service, architecture, component, module, API, request, response, client, server, network, microservice, monolith, container, docker, kubernetes, CI, CD, DevOps, pipeline, build", "القاعدة: المبني للمجهول (Passive Voice). مثال: 'The code was written by a developer'."]
        },
        aiTools: []
    },
    { phase: "مشروع التخرج", week: 32, title: "المرحلة 2: بناء الأساس", summary: "بناء قاعدة البيانات وتطبيق الهيكل المعماري وتصميم الواجهات الرئيسية.", goals: ["إنشاء قاعدة البيانات في SQL Server", "بناء طبقات المشروع (DAL, BLL)", "تصميم الواجهات الرئيسية باستخدام DevExpress"], lessons: ["Database Implementation", "Layered Architecture Setup", "UI Design"], project: "إنشاء مشروع Visual Studio بالهيكل الطبقي، بناء قاعدة البيانات باستخدام EF Core Migrations، وتصميم الواجهات الرئيسية (بدون كود برمجي بعد).",
         englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: real-time, instant, message, notification, chat, connection, hub, client, broadcast, group, signal, socket, web, live, update, event, stream, data, communication, protocol", "القاعدة: الجملة الشرطية الثالثة (Third Conditional). مثال: 'If I had known, I would have helped'."]
        },
        aiTools: []
    },
    { phase: "مشروع التخرج", week: 33, title: "المرحلة 3: تنفيذ الميزات الأساسية", summary: "تطبيق جميع الميزات الأساسية التي تم تعلمها مثل CRUD، التقارير، والصلاحيات.", goals: ["تطبيق عمليات CRUD بشكل كامل", "إنشاء التقارير الأساسية", "تفعيل نظام تسجيل الدخول والصلاحيات"], lessons: ["CRUD Implementation", "Reporting", "Security"], project: "كتابة الكود البرمجي لربط الواجهات بالـ BLL والـ DAL، تفعيل جميع عمليات الإضافة والتعديل والحذف، وإنشاء تقريرين على الأقل، وتطبيق نظام الصلاحيات.",
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: project, portfolio, resume, CV, experience, skills, qualifications, education, references, contact, job, career, interview, offer, salary, benefits, company, role, position, apply", "القاعدة: الكلام المنقول (Reported Speech). مثال: 'He said that he was tired'."]
        },
        aiTools: []
    },
    { phase: "مشروع التخرج", week: 34, title: "المرحلة 4: الاختبار والتحسين", summary: "اختبار التطبيق بشكل شامل، إصلاح الأخطاء، وتحسين الأداء والكود.", goals: ["إجراء اختبارات شاملة للتطبيق", "إصلاح جميع الأخطاء المكتشفة", "مراجعة الكود وتحسينه (Refactoring)"], lessons: ["Unit & Integration Testing", "Debugging", "Code Refactoring"], project: "كتابة Unit Tests للوظائف الحرجة في الـ BLL، إجراء اختبار يدوي شامل لكل ميزات التطبيق، تسجيل الأخطاء وإصلاحها، ثم مراجعة الكود لجعله أكثر كفاءة.",
                englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["تعلم 20 كلمة جديدة وقاعدة نحوية واحدة."],
            lessons: ["الكلمات: interview, question, answer, strength, weakness, team, company, role, position, salary, experience, skill, background, education, achievement, challenge, goal, plan, vision, value", "القاعدة: مراجعة شاملة للأسئلة والأزمنة استعدادًا للمقابلات."]
        },
        aiTools: []
    },
    { 
        phase: "مشروع التخرج", week: 35, title: "المرحلة 5: الميزات المتقدمة", 
        goals: ["إضافة ميزة متقدمة للمشروع (مثل SignalR أو gRPC)", "تحسين واجهة المستخدم بناءً على الملاحظات", "كتابة توثيق شامل للـ API"], 
        lessons: ["Adding Advanced Features", "UI/UX Polish", "API Documentation (Swagger/OpenAPI)"], 
        project: "دمج إحدى التقنيات المتقدمة في مشروعك النهائي لزيادة قيمته، وتحسين تجربة المستخدم بناءً على آراء الآخرين.",
        youtubeKeywords: ["signalr c# tutorial", "polishing ui design", "swagger documentation asp.net core"],
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["مراجعة 20 كلمة وقاعدة نحوية من الأسابيع السابقة."],
            lessons: ["مراجعة الكلمات: book, happy, because, can, fast, project, portfolio, resume, CV, experience, skills, qualifications, education, references, contact, code, bug, fix, feature, test", "القاعدة: مراجعة المضارع البسيط والماضي البسيط."]
        },
        aiTools: []
    },
            
    // Phase 11: Advanced Topics
    { phase: "مواضيع متقدمة واحترافية", week: 36, title: "WPF & MVVM Basics", summary: "الانتقال إلى WPF لإنشاء واجهات حديثة وتطبيق نمط MVVM لفصل الواجهة عن منطق العمل.", goals: ["فهم لغة XAML لتصميم الواجهات", "تطبيق نمط MVVM", "استخدام Data Binding بشكل فعال"], lessons: ["WPF Introduction, XAML", "MVVM Pattern", "Data Binding, ICommand"], project: "إعادة بناء شاشة واحدة من مشروعك النهائي (مثل شاشة إدارة العملاء) باستخدام تقنية WPF ونمط تصميم MVVM.", youtubeKeywords: ["WPF tutorial for beginners", "MVVM pattern explained", "WPF data binding C#"],
         englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["مراجعة 20 كلمة وقاعدة نحوية من الأسابيع السابقة."],
            lessons: ["مراجعة الكلمات: interview, question, answer, strength, weakness, team, company, role, position, salary, efficient, performant, optimized, slow, fast, resource, memory, CPU, analysis, profile", "القاعدة: الكلام المنقول (Reported Speech). مثال: 'He said that he was tired'."]
        },
        aiTools: []
    },
    { phase: "مواضيع متقدمة واحترافية", week: 37, title: "Concurrency & Parallelism", summary: "فهم البرمجة المتزامنة والمتوازية لتحسين أداء التطبيقات.", goals: ["فهم الفرق بين Concurrency و Parallelism", "استخدام Thread Pool و Task Parallel Library (TPL)", "التعامل مع Race Conditions و Locks"], lessons: ["Threading", "Concurrency vs. Parallelism", "Task Parallel Library (TPL)", "Locking (lock, Monitor)"], project: "تعديل جزء من مشروعك (مثل معالجة مجموعة كبيرة من البيانات) ليتم تنفيذه بشكل متوازٍ باستخدام TPL وقياس التحسن في الأداء.", youtubeKeywords: ["c# multithreading tutorial", "c# tpl data parallelism", "concurrency vs parallelism"],
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["مراجعة 20 كلمة وقاعدة نحوية من الأسابيع السابقة."],
            lessons: ["مراجعة الكلمات: service, architecture, component, module, API, request, response, client, server, network, goal, objective, task, milestone, deadline, progress, status, update, issue, risk", "القاعدة: مراجعة شاملة للأسئلة والأزمنة استعدادًا للمقابلات."]
        },
        aiTools: []
    },
    { 
        phase: "مواضيع متقدمة واحترافية", week: 38, title: "تحسين الأداء وإدارة الذاكرة", 
        goals: ["فهم آلية عمل Garbage Collector", "استخدام أدوات التحليل (Profiler) لتحديد نقاط الضعف", "تطبيق نمط IDisposable بشكل صحيح"], 
        lessons: ["Garbage Collection", ".NET Memory Management", "Profiling Tools (Visual Studio)", "IDisposable & using statement"], 
        project: "استخدام Visual Studio Profiler لتحليل أداء مشروعك النهائي، تحديد الوظائف التي تستهلك أكبر وقت أو ذاكرة، ومحاولة تحسينها.", 
        youtubeKeywords: [".NET memory management", "C# performance optimization tips", "Visual Studio profiler tutorial"],
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["مراجعة شاملة لـ 20 من المفردات والقواعد التي تم تعلمها حتى الآن."],
            lessons: ["General Vocabulary Review", "Comprehensive Grammar Review", "practice, review, learn, teach, understand, explain, debug, refactor, optimize, deploy, test, validate, confirm, deny, accept, reject, push, pull, commit, merge"]
        },
        aiTools: []
    },
    { 
        phase: "مواضيع متقدمة واحترافية", week: 39, title: "Advanced LINQ & Functional C#", 
        goals: ["فهم الفرق بين IQueryable و IEnumerable", "استخدام تعابير LINQ المعقدة", "تطبيق مبادئ البرمجة الوظيفية"], 
        lessons: ["IQueryable vs IEnumerable", "Deferred Execution", "Advanced LINQ operators", "Functional Programming concepts"], 
        project: "إعادة كتابة بعض استعلامات البيانات المعقدة في مشروعك باستخدام تعابير LINQ متقدمة، ومحاولة تطبيق أسلوب البرمجة الوظيفية في إحدى وظائف الـ BLL.", 
        youtubeKeywords: ["C# IQueryable vs IEnumerable", "Advanced LINQ C#", "Functional programming in C#"],
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["إجراء مقابلة وهمية كاملة باللغة الإنجليزية.", "التدرب على الإجابة بثقة على 'Tell me about yourself'."],
            lessons: ["Full Mock Interview (Part 1)", "Mastering Interview Questions", "Common technical questions", "Behavioral questions", "Salary negotiation basics", "Asking good questions", "Follow-up email", "Portfolio presentation", "Project deep dive", "System design basics", "problem, solution, approach, strategy, logic, algorithm, data structure, optimize, improve, measure"]
        },
        aiTools: []
    },
    { 
        phase: "مواضيع متقدمة واحترافية", week: 40, title: "Microservices & gRPC", 
        goals: ["فهم مفهوم الخدمات المصغرة (Microservices)", "بناء خدمة gRPC بسيطة", "استهلاك خدمة gRPC من تطبيق آخر"], 
        lessons: ["Microservices Architecture", "Introduction to gRPC", "Building a gRPC service in ASP.NET Core"], 
        project: "فصل إحدى وظائف مشروعك (مثل إدارة المنتجات) وتحويلها إلى خدمة مصغرة (Microservice) منفصلة باستخدام gRPC، ثم جعل المشروع الرئيسي يتواصل معها.", 
        youtubeKeywords: ["Microservices explained", "gRPC tutorial C#", "gRPC vs REST"],
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["إجراء مقابلة وهمية كاملة باللغة الإنجليزية.", "التدرب على الإجابة بثقة على 'Tell me about yourself'."],
            lessons: ["Full Mock Interview (Part 2)", "Advanced Technical Questions", "System Design Interview Prep", "Explaining your project clearly", "Discussing team collaboration", "Handling difficult questions", "Negotiation practice", "CV review", "LinkedIn profile optimization", "GitHub profile review", "strength, weakness, challenge, success, failure, teamwork, leadership, communication, deadline, pressure"]
        },
        aiTools: []
    },
    { 
        phase: "مواضيع متقدمة واحترافية", week: 41, title: "Real-time Apps with SignalR", 
        goals: ["فهم آلية عمل SignalR", "بناء SignalR Hub", "إرسال واستقبال الرسائل في الوقت الفعلي"], 
        lessons: ["Introduction to SignalR", "SignalR Hubs", "Real-time communication"], 
        project: "إضافة نظام إشعارات حية لمشروعك باستخدام SignalR: عند إضافة منتج جديد، يجب أن يظهر إشعار فوري لجميع المستخدمين المتصلين حاليًا.", 
        youtubeKeywords: ["SignalR tutorial C#", "Real time application with SignalR", "ASP.NET Core SignalR"],
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["إجراء مقابلة وهمية كاملة باللغة الإنجليزية.", "التدرب على الإجابة بثقة على 'Tell me about yourself'."],
            lessons: ["Full Mock Interview (Final)", "Mock Salary Negotiation", "Final CV Polish", "Crafting cover letters", "Job application strategy", "Networking on LinkedIn", "Preparing for phone screening", "On-site interview prep", "Whiteboarding practice", "Final project demo practice", "professional, confident, fluent, clear, concise, articulate, persuasive, positive, motivated, proactive"]
        },
        aiTools: []
    },
            
    // Phase 12: Career Prep
    { 
        phase: "الاستعداد الوظيفي", week: 42, title: "الانطلاق في المسار الوظيفي", 
        summary: "تجهيز السيرة الذاتية والمشروع النهائي والتدرب على المقابلات للانطلاق في سوق العمل.", 
        goals: ["صقل المشروع النهائي وإضافة ميزة متقدمة", "كتابة README احترافي وتسجيل فيديو للمشروع", "بناء سيرة ذاتية احترافية والتحضير للمقابلات"], 
        lessons: ["Final Project Polish", "Professional README & Demo Video", "CV Writing & Interview Prep"], 
        project: "تجهيز ملفك الشخصي بالكامل (سيرة ذاتية، LinkedIn، GitHub) والبدء بالتقديم على الوظائف المناسبة.",
        englishTrack: {
            title: "تطوير اللغة الإنجليزية",
            icon: 'english',
            goals: ["إجراء مقابلة وهمية كاملة باللغة الإنجليزية.", "التدرب على الإجابة بثقة على 'Tell me about yourself'."],
            lessons: ["Final Mock Interview with Peer", "Reviewing all 42 grammar rules", "Reviewing all 840 words", "Writing professional emails", "Understanding job descriptions", "Company research skills", "Networking follow-ups", "First 90 days plan", "Continuous learning strategy", "Building online presence", "Congratulations!", "You", "Are", "Ready", "For", "The", "Job", "Market", "Good", "Luck!"]
        },
        aiTools: []
    },
];
        
        const phaseGoals = {
            "تأسيس C#": "الهدف: بناء أساس برمجي متين في C#. بالتوازي، ستبدأ رحلة في تحليل البيانات باستخدام SQL، من الأساسيات إلى الاستعلامات المتقدمة.",
            "تطوير تطبيقات سطح المكتب": "الهدف: القدرة على بناء واجهات تطبيقات سطح مكتب تفاعلية باستخدام WinForms، مع تعميق فهمك لـ SQL المستخدم في تحليل البيانات.",
            "قواعد البيانات": "الهدف: إتقان لغة SQL لتصميم قواعد البيانات وإدارتها، مع التخصص في كتابة استعلامات تحليلية معقدة ومحسنة.",
            "الوصول للبيانات": "الهدف: تعلم ربط تطبيقات C# بقواعد البيانات، وفي نفس الوقت، تحويل هذه البيانات إلى رؤى وتقارير تفاعلية باستخدام Power BI.",
            "هندسة البرمجيات": "الهدف: تطبيق مبادئ التصميم الاحترافية لبناء برمجيات قوية، مع استكمال رحلتك في Power BI لإنشاء لوحات معلومات ومشاركتها.",
            "واجهات احترافية": "الهدف: استخدام أدوات متقدمة لتصميم واجهات احترافية، وبدء رحلتك مع Python كلغة أساسية لتحليل البيانات.",
            "تكامل متقدم": "الهدف: دمج ميزات متقدمة في التطبيقات، وتوسيع مهاراتك في Python لتشمل تصور البيانات وبناء نماذج تعلم الآلة الأولية.",
            "التطوير الحديث والـ APIs": "الهدف: بناء واجهات برمجية (APIs) وربط تطبيقات سطح المكتب بها، مع التوسع في تعلم الآلة باستخدام Python لبناء نماذج تصنيف وتجميع.",
            "النشر و DevOps": "الهدف: تعلم كيفية نشر التطبيقات بشكل احترافي وأتمتة هذه العملية باستخدام أدوات حديثة مثل Docker و GitHub Actions.",
            "مشروع التخرج": "الهدف: تطبيق جميع المهارات المكتسبة في بناء مشروع متكامل يثبت كفاءتك كمطور محترف.",
            "مواضيع متقدمة واحترافية": "الهدف: استكشاف تقنيات ومفاهيم متقدمة مثل WPF, Microservices, و SignalR للارتقاء بمهاراتك إلى مستوى الخبراء.",
            "الاستعداد الوظيفي": "الهدف: تجهيز سيرتك الذاتية، ملفك الشخصي، والتحضير للمقابلات التقنية للانطلاق في سوق العمل بثقة."
        };

        const START_DATE = new Date(2025, 10, 1); // October is month 9 (0-indexed)
        const TOTAL_WEEKS = 42;

        const filterButtonsContainer = document.getElementById('filter-buttons');
        const statusFilterContainer = document.getElementById('status-filter-buttons');
        const weeksContainer = document.getElementById('weeks-container');
        const modal = document.getElementById('detailsModal');
        const modalBody = document.getElementById('modalBody');
        const closeModalBtn = document.getElementById('closeModal');
        const progressBar = document.getElementById('progressBar');
        const dateRangeSpan = document.getElementById('date-range');
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        
        let activePhaseFilter = 'الكل';
        let activeStatusFilter = 'الكل';
        const phases = ['الكل', ...new Set(roadmapData.map(item => item.phase))];
        const statuses = ['الكل', 'المكتملة', 'غير المكتملة'];
        let myChart = null; 
        let completedWeeks = [];

        const icons = {
            csharp: `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M13.54,22.21,12,23.75,3.71,15.46l8.29-8.29,1.54,1.54L8.79,13.46,12,16.67l3.21-3.21-4.75-4.75L12,7.17l8.29,8.29-6.75,6.75ZM12,1.25,1.25,12,12,22.75,22.75,12,12,1.25Z"/></svg>`,
            excel: `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M21.17,3.25,17,2H7A2,2,0,0,0,5,4V20a2,2,0,0,0,2,2H17a2,2,0,0,0,2-2V8.5ZM16,20H8V4h8v5h5v3.33l-2-1.33v-2H15V4h-1.33L12,5.67,10.33,4H9V16h1.33L12,14.33,13.67,16H15V20Z" /></svg>`,
            sql: `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10,0,0,0,2,12a9.89,9.89,0,0,0,2.26,6.33L3.41,19.17,4,19.75l.85-.85a10,10,0,1,0,7.15-16.9ZM16,16H8V14h8Zm0-3H8V11h8Zm0-3H8V8h8Z"/></svg>`,
            powerbi: `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M4,4V20H20V4ZM18,18H6V6H18Zm-9-1h2V9H9Zm3,0h2V13H12Zm3,0h2V11H15Z"/></svg>`,
            python: `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M20.27,11.3,16.79,7.82,13.3,4.34a2,2,0,0,0-2.83,0L8.21,6.59,4.73,10.07A2,2,0,0,0,4.73,12.9L8.21,16.38l2.25,2.24,1.35,1.35,2.24,2.25a2,2,0,0,0,2.83,0l3.48-3.48,3.48-3.48a2,2,0,0,0,0-2.83ZM10.46,8.83l1.1-1.1,1.1,1.1-1.1,1.1Zm3.08,1.52L12,11.91l-1.54-1.54L12,8.83ZM8.21,12.9,9.75,11.36l1.54,1.54-1.54,1.54Zm7.08,1.54L13.75,16,12.21,14.44l1.54-1.54Z" /></svg>`,
            english: `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12.87,15.07,10.33,12.54,12.87,10.03,15.41,12.54M21.1,12.5,14.24,5.64,12,3.4,9.76,5.64,2.9,12.5,9.76,19.36,12,21.6,14.24,19.36,21.1,12.5M22.5,12.5,15.64,5.64,13.4,3.4,12,2,10.6,3.4,8.36,5.64,1.5,12.5,8.36,19.36,10.6,21.6,12,23,13.4,21.6,15.64,19.36,22.5,12.5Z"/></svg>`
        }
        
        // --- START: Gemini API Integration ---
        const API_KEY = ""; 
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
        const TTS_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${API_KEY}`;

        // Schema for the new Flashcard feature (Structured Output)
        const FLASHCARD_SCHEMA = {
            type: "ARRAY",
            items: {
                type: "OBJECT",
                properties: {
                    "concept": { "type": "STRING", "description": "اسم المفهوم (باللغة الإنجليزية)" },
                    "definition": { "type": "STRING", "description": "شرح مبسط للمفهوم في جملة واحدة (باللغة العربية)" },
                    "code_example": { "type": "STRING", "description": "مثال كود C# قصير جداً (لا يزيد عن 5 أسطر) يوضح المفهوم" }
                },
                required: ["concept", "definition", "code_example"]
            }
        };

        // Helper function to escape HTML for code rendering
        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/[&<>"']/g, function(m) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                }[m];
            });
        }

        // Helper function to format JSON flashcards into HTML
        function formatFlashcards(data) {
            let html = '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
            let rawText = 'سيتم الآن قراءة بطاقات المراجعة. ';
            data.forEach((card, index) => {
                const concept = escapeHtml(card.concept);
                const definition = escapeHtml(card.definition);
                const code_example = escapeHtml(card.code_example);

                html += `
                    <div class="border border-gray-300 dark:border-gray-600 rounded-lg p-4 bg-white dark:bg-gray-700 shadow-sm">
                        <h4 class="font-bold text-lg text-indigo-600 dark:text-indigo-400">${concept}</h4>
                        <p class="text-sm text-gray-700 dark:text-gray-300 mt-2">${definition}</p>
                        <pre class="bg-gray-100 dark:bg-gray-800 p-2 rounded-md text-sm text-left font-mono dir-ltr overflow-x-auto mt-3"><code>${code_example}</code></pre>
                    </div>`;
                
                rawText += `البطاقة ${index + 1}: المفهوم: ${concept}. التعريف: ${definition}. مثال الكود: ${code_example}. `;
            });
            html += '</div>';
            return { html, rawText };
        }

        /**
         * Processes the candidate response from Gemini API.
         * @param {object} candidate - The candidate object from the API response.
         * @param {boolean} jsonSchema - Whether to parse the response as JSON.
         * @returns {object} An object containing { contentHtml, rawText }.
         */
        function processGeminiResponse(candidate, jsonSchema = false) {
            const text = candidate?.content?.parts?.[0]?.text;

            if (!text) {
                return { 
                    contentHtml: '<p class="text-red-500">حدث خطأ أثناء جلب الرد. الرجاء المحاولة مرة أخرى.</p>', 
                    rawText: 'حدث خطأ.' 
                };
            }

            let formattedText = '';
            let rawTextForTTS = '';
            
            if (jsonSchema) {
                try {
                    const parsedJson = JSON.parse(text);
                    const { html, rawText } = formatFlashcards(parsedJson);
                    formattedText = html;
                    rawTextForTTS = rawText;
                } catch (e) {
                    console.error("Failed to parse JSON response:", e);
                    formattedText = "<p class='text-red-500'>حدث خطأ أثناء تحليل بيانات البطاقات.</p>";
                    rawTextForTTS = "حدث خطأ في تحليل البيانات.";
                }
            } else {
                rawTextForTTS = text;
                // Basic markdown formatting to HTML
                formattedText = text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/^- (.*)/gm, '<li class="flex items-start"><span class="mr-2 mt-1">🔹</span><span>$1</span></li>')
                    .replace(/\* (.*)/gm, '<li class="flex items-start"><span class="mr-2 mt-1">🔸</span><span>$1</span></li>')
                    .replace(/\n/g, '<br>');
            }
            
            let sourcesHtml = '';
            if (candidate.groundingMetadata && candidate.groundingMetadata.groundingAttributions) {
                const sources = candidate.groundingMetadata.groundingAttributions
                    .map(attribution => ({
                        uri: attribution.web?.uri,
                        title: attribution.web?.title,
                    }))
                    .filter(source => source.uri && source.title);
                
                if (sources.length > 0) {
                    sourcesHtml = '<h5 class="font-bold mt-4 mb-2 text-gray-700 dark:text-gray-300">المصادر:</h5><ul class="space-y-1 text-sm">';
                    sources.forEach((source, index) => {
                        sourcesHtml += `<li class="truncate"><a href="${source.uri}" target="_blank" class="text-blue-500 hover:underline">${index + 1}. ${source.title}</a></li>`;
                    });
                    sourcesHtml += '</ul>';
                }
            }
            
            const mainContentHtml = `<div class="space-y-2" id="gemini-text-content">${formattedText}</div>${sourcesHtml}`;
            return { contentHtml: mainContentHtml, rawText: rawTextForTTS };
        }

        /**
         * Displays the processed Gemini response in the UI, including the TTS button.
         * @param {string} contentHtml - The main formatted HTML to display.
         * @param {string} rawText - The raw text to be used for Text-to-Speech.
         */
        function displayGeminiResponse(contentHtml, rawText) {
            const geminiResponseContainer = document.getElementById('gemini-response');
            if (!geminiResponseContainer) return;

            geminiResponseContainer.innerHTML = `
                ${contentHtml}
                <audio id="tts-audio-player" class="w-full mt-4 hidden" controls></audio>
                <button id="gemini-tts-btn" class="gemini-btn gemini-btn-career w-full mt-2" style="background-image: linear-gradient(to right, #4f46e5, #6366f1); border-color: #4338ca;">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072M17.657 6.343a8 8 0 010 11.314M19.778 4.222a11 11 0 010 15.556M4.222 19.778a11 11 0 010-15.556M6.343 17.657a8 8 0 010-11.314M8.464 15.536a5 5 0 010-7.072"></path></svg>
                    <span>قراءة الرد بصوت عالٍ</span>
                </button>
            `;
            
            document.getElementById('gemini-tts-btn').addEventListener('click', () => {
                generateTTS(rawText);
            });
        }


        async function fetchWithBackoff(url, options, maxRetries = 5) {
            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return response;
                    
                    // Handle rate limiting (429) or temporary server errors (5xx)
                    if (response.status === 429 || response.status >= 500) {
                        const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue; 
                    }
                    return response; // Non-retryable error (e.g., 400, 404, 401)
                } catch (error) {
                    // Handle network errors
                    if (attempt < maxRetries - 1) {
                         const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                         await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        throw error;
                    }
                }
            }
            throw new Error('Max retries reached.');
        }

        async function generateContent(prompt, useGrounding = false, jsonSchema = null) {
            const geminiResponseContainer = document.getElementById('gemini-response');
            const geminiLoader = document.getElementById('gemini-loader');
            if(!geminiResponseContainer || !geminiLoader) return;

            geminiResponseContainer.innerHTML = '';
            geminiLoader.style.display = 'block';

            try {
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                };

                if (useGrounding) {
                    payload.tools = [{ "google_search": {} }];
                }

                if (jsonSchema) {
                    payload.generationConfig = {
                        responseMimeType: "application/json",
                        responseSchema: jsonSchema
                    };
                }

                const response = await fetchWithBackoff(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.statusText}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];
                
                const { contentHtml, rawText } = processGeminiResponse(candidate, jsonSchema);
                displayGeminiResponse(contentHtml, rawText);

            } catch (error) {
                console.error("Gemini API call failed:", error);
                geminiResponseContainer.innerHTML = `<p class="text-red-500">لا يمكن الوصول إلى الخدمة حالياً. يرجى التحقق من اتصالك بالإنترنت.</p>`;
            } finally {
                geminiLoader.style.display = 'none';
            }
        }
        
        async function generateContentWithImage(prompt, imageFile) {
            const geminiResponseContainer = document.getElementById('gemini-response');
            const geminiLoader = document.getElementById('gemini-loader');
            if (!geminiResponseContainer || !geminiLoader) return;

            geminiResponseContainer.innerHTML = '';
            geminiLoader.style.display = 'block';

            const reader = new FileReader();
            reader.readAsDataURL(imageFile);
            reader.onload = async () => {
                try {
                    const base64Data = reader.result.split(',')[1];
                    const mimeType = imageFile.type;

                    const payload = {
                        contents: [
                            {
                                role: "user",
                                parts: [
                                    { text: prompt },
                                    {
                                        inlineData: {
                                            mimeType: mimeType,
                                            data: base64Data
                                        }
                                    }
                                ]
                            }
                        ],
                    };

                    const response = await fetchWithBackoff(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.statusText}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    
                    const { contentHtml, rawText } = processGeminiResponse(candidate, false); 
                    displayGeminiResponse(contentHtml, rawText);

                } catch (error) {
                    console.error("Gemini API call failed:", error);
                    geminiResponseContainer.innerHTML = `<p class="text-red-500">لا يمكن الوصول إلى الخدمة حالياً. يرجى التحقق من اتصالك بالإنترنت.</p>`;
                } finally {
                    geminiLoader.style.display = 'none';
                }
            };
            reader.onerror = (error) => {
                console.error("File reading error:", error);
                geminiResponseContainer.innerHTML = `<p class="text-red-500">حدث خطأ أثناء قراءة ملف الصورة.</p>`;
                geminiLoader.style.display = 'none';
            };
        }

        // --- START: TTS Helper Functions (Copied from previous successful execution) ---
        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcmData, sampleRate) {
            const numSamples = pcmData.length;
            const numChannels = 1;
            const bytesPerSample = 2; // 16-bit PCM
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;
            const dataSize = numSamples * blockAlign;
            const waveHeaderSize = 44;
            const fileSize = waveHeaderSize + dataSize;
            
            const buffer = new ArrayBuffer(fileSize);
            const view = new DataView(buffer);

            // RIFF header
            view.setUint32(0, 0x46464952, false); // "RIFF"
            view.setUint32(4, fileSize - 8, true); // File size - 8
            view.setUint32(8, 0x45564157, false); // "WAVE"
            
            // fmt chunk
            view.setUint32(12, 0x20746d66, false); // "fmt "
            view.setUint32(16, 16, true); // Sub-chunk 1 size (16 for PCM)
            view.setUint16(20, 1, true); // Audio format (1 for PCM)
            view.setUint16(22, numChannels, true); // Number of channels
            view.setUint32(24, sampleRate, true); // Sample rate
            view.setUint32(28, byteRate, true); // Byte rate
            view.setUint16(32, blockAlign, true); // Block align
            view.setUint16(34, bytesPerSample * 8, true); // Bits per sample (16)
            
            // data chunk
            view.setUint32(36, 0x61746164, false); // "data"
            view.setUint32(40, dataSize, true); // Sub-chunk 2 size
            
            // Write PCM data
            for (let i = 0; i < numSamples; i++) {
                view.setInt16(waveHeaderSize + i * 2, pcmData[i], true);
            }
            
            return new Blob([view], { type: 'audio/wav' });
        }

        async function generateTTS(textToRead) {
            const ttsButton = document.getElementById('gemini-tts-btn');
            const audioPlayer = document.getElementById('tts-audio-player');
            if (!ttsButton || !audioPlayer) return;

            const originalButtonText = ttsButton.innerHTML;
            ttsButton.innerHTML = '<span>... جاري تحضير الصوت ...</span><div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>';
            ttsButton.disabled = true;
            audioPlayer.style.display = 'none';

            try {
                const payload = {
                    contents: [{
                        parts: [{ text: `Say in a clear, informative, and friendly tone: ${textToRead}` }]
                    }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: {
                            voiceConfig: {
                                prebuiltVoiceConfig: { voiceName: "Kore" } // A clear, firm voice
                            }
                        }
                    },
                    model: "gemini-2.5-flash-preview-tts"
                };

                const response = await fetchWithBackoff(TTS_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`TTS API Error: ${response.statusText}`);

                const result = await response.json();
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/")) {
                    const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                    const sampleRate = sampleRateMatch ? parseInt(sampleRateMatch[1], 10) : 24000;
                    
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    
                    audioPlayer.src = audioUrl;
                    audioPlayer.style.display = 'block';
                    audioPlayer.play();
                } else {
                    throw new Error('Invalid TTS response data.');
                }

            } catch (error) {
                console.error("Gemini TTS call failed:", error);
                ttsButton.innerHTML = '<span>حدث خطأ في الصوت</span>';
            } finally {
                // Restore button after a short delay to allow 'error' message to be seen
                setTimeout(() => {
                    ttsButton.innerHTML = originalButtonText;
                    ttsButton.disabled = false;
                }, 2000);
            }
        }
        // --- END: TTS Helper Functions ---

        function loadState() {
            const savedState = localStorage.getItem('csharpRoadmapState');
            if (savedState) {
                completedWeeks = JSON.parse(savedState);
            }
        }

        function saveState() {
            localStorage.setItem('csharpRoadmapState', JSON.stringify(completedWeeks));
        }

        function toggleWeekCompletion(weekId) {
            const weekNumber = parseInt(weekId);
            const index = completedWeeks.indexOf(weekNumber);
            if (index > -1) {
                completedWeeks.splice(index, 1);
            } else {
                completedWeeks.push(weekNumber);
            }
            saveState();
            renderWeeks();
            updateProgressBar();
        }

        function handleThemeToggle() {
            if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                themeToggleLightIcon.classList.remove('hidden');
            } else {
                themeToggleDarkIcon.classList.remove('hidden');
            }

            themeToggleBtn.addEventListener('click', function() {
                themeToggleDarkIcon.classList.toggle('hidden');
                themeToggleLightIcon.classList.toggle('hidden');
                let event = new Event('themeChanged');
                if (localStorage.getItem('color-theme')) {
                    if (localStorage.getItem('color-theme') === 'light') {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('color-theme', 'dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                        localStorage.setItem('color-theme', 'light');
                    }
                } else {
                    if (document.documentElement.classList.contains('dark')) {
                        document.documentElement.classList.remove('dark');
                        localStorage.setItem('color-theme', 'light');
                    } else {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('color-theme', 'dark');
                    }
                }
                renderChart();
            });
        }

        function updateRoadmapDates() {
            const endDate = new Date(START_DATE.getTime() + (TOTAL_WEEKS - 1) * 7 * 24 * 60 * 60 * 1000);
            endDate.setDate(endDate.getDate() + 6);
            dateRangeSpan.textContent = `📅 البداية: ${START_DATE.toLocaleDateString('en-GB')} | 🏁 النهاية: ${endDate.toLocaleDateString('en-GB')}`;
            roadmapData.forEach((item, index) => {
                const weekStart = new Date(START_DATE.getTime() + index * 7 * 24 * 60 * 60 * 1000);
                const weekEnd = new Date(weekStart.getTime() + 6 * 24 * 60 * 60 * 1000);
                weekEnd.setHours(23, 59, 59, 999);
                item.dates = `${weekStart.toLocaleDateString('en-GB')} – ${weekEnd.toLocaleDateString('en-GB')}`;
            });
        }
        
        function updateProgressBar() {
            const progressPercentage = (completedWeeks.length / TOTAL_WEEKS) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            progressBar.textContent = `${Math.round(progressPercentage)}%`;
        }
        
        function renderFilters() {
            filterButtonsContainer.innerHTML = phases.map(phase => `
                <button class="filter-btn px-4 py-2 text-sm font-semibold rounded-full transition-all duration-300 ${activePhaseFilter === phase ? 'active-filter' : 'bg-white text-gray-700 hover:bg-gray-100 shadow-sm'}" data-phase="${phase}">
                    ${phase}
                </button>
            `).join('');
            statusFilterContainer.innerHTML = statuses.map(status => `
                <button class="status-filter-btn px-4 py-2 text-sm font-semibold rounded-full transition-all duration-300 ${activeStatusFilter === status ? 'active-filter' : 'bg-white text-gray-700 hover:bg-gray-100 shadow-sm'}" data-status="${status}">
                    ${status}
                </button>
            `).join('');
        }

        function isCurrentWeek(item) {
            const today = new Date();
            const weekStartDate = new Date(START_DATE.getTime() + (item.week - 1) * 7 * 24 * 60 * 60 * 1000);
            const weekEndDate = new Date(weekStartDate.getTime() + 6 * 24 * 60 * 60 * 1000);
            weekEndDate.setHours(23, 59, 59, 999);
            return today >= weekStartDate && today <= weekEndDate;
        }

        function renderWeeks() {
            weeksContainer.innerHTML = '';
            let filteredData = roadmapData;
            if (activePhaseFilter !== 'الكل') {
                filteredData = filteredData.filter(item => item.phase === activePhaseFilter);
            }
            if (activeStatusFilter === 'المكتملة') {
                filteredData = filteredData.filter(item => completedWeeks.includes(item.week));
            } else if (activeStatusFilter === 'غير المكتملة') {
                filteredData = filteredData.filter(item => !completedWeeks.includes(item.week));
            }

            const phasesToRender = [...new Set(filteredData.map(item => item.phase))];

            if (phasesToRender.length === 0) {
                weeksContainer.innerHTML = `<p class="text-center text-gray-500">لا توجد أسابيع تطابق معايير البحث.</p>`;
                return;
            }

            phasesToRender.forEach((phase, phaseIndex) => {
                const phaseWeeks = filteredData.filter(item => item.phase === phase);
                
                const csharpLessons = new Set();
                const dataAnalysisLessons = new Set();
                const techIcons = new Set(['csharp']);

                phaseWeeks.forEach(item => {
                    item.lessons.forEach(lesson => csharpLessons.add(lesson));
                    if (item.parallelTrack) {
                        techIcons.add(item.parallelTrack.icon);
                        item.parallelTrack.lessons.forEach(lesson => dataAnalysisLessons.add(lesson));
                    }
                });

                const iconsHtml = Array.from(techIcons).map(iconKey => icons[iconKey] || '').join('');

                const summaryCardHtml = `
                <div class="phase-summary-card fade-in-up" style="animation-delay: 50ms;">
                    <div class="summary-header flex justify-between items-center cursor-pointer">
                        <h3 class="text-xl font-bold text-gray-800">ملخص مهارات المرحلة</h3>
                        <div class="flex items-center">
                            <div class="tech-icon-container mr-4">
                                ${iconsHtml}
                            </div>
                            <svg class="w-6 h-6 text-gray-500 summary-toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                    </div>
                    <div class="summary-content mt-4 hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                            <div>
                                <h4 class="font-bold mb-2 text-indigo-600">مهارات C# والتطوير</h4>
                                <div class="space-y-2">
                                ${Array.from(csharpLessons).map(lesson => `
                                    <div class="flex items-start text-sm">
                                        <svg class="w-4 h-4 mr-2 mt-1 text-indigo-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                        <span class="text-gray-700 dark:text-gray-300">${lesson}</span>
                                    </div>
                                `).join('')}
                                </div>
                            </div>
                            ${dataAnalysisLessons.size > 0 ? `
                            <div>
                                <h4 class="font-bold mb-2 text-emerald-600">مهارات تحليل البيانات</h4>
                                <div class="space-y-2">
                                ${Array.from(dataAnalysisLessons).map(lesson => `
                                    <div class="flex items-start text-sm">
                                        <svg class="w-4 h-4 mr-2 mt-1 text-emerald-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                        <span class="text-gray-700 dark:text-gray-300">${lesson}</span>
                                    </div>
                                `).join('')}
                                </div>
                            </div>` : ''}
                        </div>
                    </div>
                </div>
                `;

                const phaseHtml = `
                    <div class="phase-section" style="animation-delay: ${phaseIndex * 100}ms;">
                        <div class="text-center md:text-right mb-8">
                            <h2 class="text-3xl font-extrabold text-gray-800 phase-title inline-block">${phase}</h2>
                            <p class="text-gray-600 mt-2 max-w-2xl mx-auto md:mx-0">${phaseGoals[phase] || ''}</p>
                        </div>
                        ${summaryCardHtml}
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            ${phaseWeeks.map((item, index) => {
                                const isCompleted = completedWeeks.includes(item.week);
                                const isCurrent = isCurrentWeek(item);
                                const completedClass = isCompleted ? 'completed' : '';
                                const currentWeekClass = isCurrent ? 'current-week' : '';
                                const parallelTrackBadge = item.parallelTrack ? '<span class="parallel-track-badge">مسار مزدوج</span>' : '';
                                return `
                                <div class="week-card rounded-xl shadow-md flex flex-col h-full ${completedClass} ${currentWeekClass} fade-in-up" style="animation-delay: ${index * 50}ms;">
                                    <div class="completed-overlay"></div>
                                    <div class="completed-check-icon w-8 h-8">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                                    </div>
                                    <div class="p-6 flex-grow cursor-pointer" data-week="${item.week}">
                                        <div class="flex justify-between items-center mb-3">
                                            <span class="text-sm font-bold bg-indigo-100 text-indigo-800 py-1 px-3 rounded-full">الأسبوع ${item.week}</span>
                                            <div class="flex items-center gap-2">
                                                ${parallelTrackBadge}
                                                ${isCurrent && !isCompleted ? '<span class="text-xs font-bold text-emerald-600 animate-pulse">الحالي</span>' : ''}
                                            </div>
                                        </div>
                                        <h3 class="text-xl font-bold text-gray-900 mb-2">${item.title}</h3>
                                        <p class="text-xs text-gray-500 mb-4">${item.dates}</p>
                                        <ul class="text-sm text-gray-600 space-y-2">
                                            ${item.goals.slice(0, 2).map(goal => `<li class="flex items-start"><svg class="w-4 h-4 mr-2 mt-1 text-emerald-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>${goal}</span></li>`).join('')}
                                        </ul>
                                    </div>
                                    <div class="bg-gray-50 p-3 mt-auto rounded-b-xl border-t border-gray-200 text-center z-10">
                                         <button class="btn-complete text-sm" data-week-id="${item.week}">${isCompleted ? 'مكتمل' : 'إكمال'}</button>
                                    </div>
                                </div>
                                `
                            }).join('')}
                        </div>
                    </div>
                `;
                weeksContainer.innerHTML += phaseHtml;
            });

            // Add event listeners for the new toggle functionality
            document.querySelectorAll('.summary-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    content.classList.toggle('hidden');
                    header.classList.toggle('collapsed');
                });
            });
        }
        
        function buildKeywordsHtml(keywords) {
             if (!keywords || keywords.length === 0) return '';
            return keywords.map(keyword => `
                <li class="flex items-center justify-between bg-gray-100 dark:bg-gray-700 p-2 rounded-md">
                    <span class="text-gray-700 dark:text-gray-300 font-mono text-sm">${keyword}</span>
                    <button class="copy-btn text-gray-600 dark:text-gray-400" data-keyword="${keyword}">نسخ</button>
                </li>
            `).join('');
        }
        
        function showModal(weekNumber) {
            const item = roadmapData.find(d => d.week == weekNumber);
            if (!item) return;
            
            let staticContentHtml = '';

            const csharpTrackHtml = `
                <div class="p-4 rounded-lg">
                    <h3 class="flex items-center gap-3 text-2xl font-bold mb-4 text-indigo-600 border-b-2 border-indigo-200 pb-2">${icons.csharp} مسار: ${item.title}</h3>
                    <h4 class="font-bold text-lg mt-4 mb-2 text-gray-800">🎯 الأهداف</h4>
                    <ul class="space-y-2 text-sm">${item.goals.map(g => `<li class="flex items-start"><svg class="w-4 h-4 mr-2 mt-1 text-indigo-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="text-gray-700 dark:text-gray-300">${g}</span></li>`).join('')}</ul>
                    <h4 class="font-bold text-lg mt-4 mb-2 text-gray-800">📚 المفاهيم والدروس</h4>
                    <ul class="list-disc list-inside space-y-1 text-sm text-gray-700 dark:text-gray-300">${item.lessons.map(l => `<li>${l}</li>`).join('')}</ul>
                    ${item.project ? `<h4 class="font-bold text-lg mt-4 mb-2 text-gray-800">💻 المشروع التطبيقي</h4><p class="bg-indigo-50 dark:bg-indigo-900/30 p-3 rounded-md border-l-4 border-indigo-500 text-sm text-gray-800 dark:text-gray-300">${item.project}</p>` : ''}
                    ${item.youtubeKeywords && item.youtubeKeywords.length > 0 ? `<h4 class="font-bold text-lg mt-4 mb-2 text-gray-800">📺 كلمات بحث مقترحة</h4><ul class="space-y-2">${buildKeywordsHtml(item.youtubeKeywords)}</ul>` : ''}
                </div>`;

            let parallelTrackHtml = '';
            if (item.parallelTrack) {
                parallelTrackHtml = `
                <div class="p-4 rounded-lg border-t-2 md:border-t-0 md:border-r-2 border-gray-200 dark:border-gray-700 mt-6 md:mt-0 pt-6 md:pt-0 md:pr-8">
                     <h3 class="flex items-center gap-3 text-2xl font-bold mb-4 text-emerald-600 border-b-2 border-emerald-200 pb-2">${icons[item.parallelTrack.icon]} مسار: ${item.parallelTrack.title}</h3>
                     <h4 class="font-bold text-lg mt-4 mb-2 text-gray-800">🎯 الأهداف</h4>
                    <ul class="space-y-2 text-sm">${item.parallelTrack.goals.map(g => `<li class="flex items-start"><svg class="w-4 h-4 mr-2 mt-1 text-emerald-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="text-gray-700 dark:text-gray-300">${g}</span></li>`).join('')}</ul>
                    <h4 class="font-bold text-lg mt-4 mb-2 text-gray-800">📚 المفاهيم والدروس</h4>
                    <ul class="list-disc list-inside space-y-1 text-sm text-gray-700 dark:text-gray-300">${item.parallelTrack.lessons.map(l => `<li>${l}</li>`).join('')}</ul>
                    ${item.parallelTrack.project ? `<h4 class="font-bold text-lg mt-4 mb-2 text-gray-800">💻 المشروع التطبيقي</h4><p class="bg-emerald-50 dark:bg-emerald-900/30 p-3 rounded-md border-l-4 border-emerald-500 text-sm text-gray-800 dark:text-gray-300">${item.parallelTrack.project}</p>` : ''}
                    ${item.parallelTrack.youtubeKeywords && item.parallelTrack.youtubeKeywords.length > 0 ? `<h4 class="font-bold text-lg mt-4 mb-2 text-gray-800">📺 كلمات بحث مقترحة</h4><ul class="space-y-2">${buildKeywordsHtml(item.parallelTrack.youtubeKeywords)}</ul>` : ''}
                </div>`;
            }

            let englishTrackHtml = '';
            if (item.englishTrack) {
                englishTrackHtml = `
                 <div class="p-4 rounded-lg mt-6 pt-6 border-t-2 border-gray-200 dark:border-gray-700">
                     <h3 class="flex items-center gap-3 text-2xl font-bold mb-4" style="color: var(--english-color);"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m4.25 16a4.25 4.25 0 000-8.5H12a4.25 4.25 0 000 8.5h.25zM17 12a4.25 4.25 0 100-8.5H12a4.25 4.25 0 100 8.5h5zM3 17l6-6-6-6"></path></svg> مسار: ${item.englishTrack.title}</h3>
                     <h4 class="font-bold text-lg mt-4 mb-2 text-gray-800">🎯 الأهداف</h4>
                    <ul class="space-y-2 text-sm">${item.englishTrack.goals.map(g => `<li class="flex items-start"><svg class="w-4 h-4 mr-2 mt-1 flex-shrink-0" style="color: var(--english-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="text-gray-700 dark:text-gray-300">${g}</span></li>`).join('')}</ul>
                    <h4 class="font-bold text-lg mt-4 mb-2 text-gray-800">📚 المفاهيم والدروس</h4>
                    <ul class="list-disc list-inside space-y-1 text-sm text-gray-700 dark:text-gray-300">${item.englishTrack.lessons.map(l => `<li>${l}</li>`).join('')}</ul>
                    ${item.englishTrack.youtubeKeywords && item.englishTrack.youtubeKeywords.length > 0 ? `<h4 class="font-bold text-lg mt-4 mb-2 text-gray-800">📺 كلمات بحث مقترحة</h4><ul class="space-y-2">${buildKeywordsHtml(item.englishTrack.youtubeKeywords)}</ul>` : ''}
                </div>`;
            }

            // The AI Tools section is now the Gemini Assistant section
            const aiToolsHtml = '';

            if (item.parallelTrack || item.englishTrack) {
                 staticContentHtml = `
                    <div class="text-center mb-6">
                        <h2 class="text-3xl font-extrabold text-gray-900 dark:text-gray-50">الأسبوع ${item.week}</h2>
                        <p class="text-sm text-gray-500 mt-1">${item.dates}</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 md:gap-x-8">
                        ${csharpTrackHtml}
                        <div>
                         ${parallelTrackHtml}
                         ${englishTrackHtml}
                         ${aiToolsHtml}
                        </div>
                    </div>`;
            } else {
                 staticContentHtml = `
                    <div class="text-center mb-6">
                        <h2 class="text-3xl font-extrabold text-gray-900 dark:text-gray-50">${item.title} (الأسبوع ${item.week})</h2>
                        <p class="text-sm text-gray-500 mt-1">${item.dates}</p>
                    </div>
                    ${csharpTrackHtml}
                    ${englishTrackHtml} 
                    ${aiToolsHtml}
                `;
            }
 
            // Gemini AI Assistant HTML (RE-ACTIVATED)
            const geminiHtml = `
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <h4 class="font-bold text-xl mb-4 text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-500">✨ مساعدك الذكي</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                        <button id="gemini-flashcard-btn" class="gemini-btn gemini-btn-explain">
                           <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M5 11v2m14-2v2"></path></svg>
                            ✨ إنشاء بطاقات
                        </button>
                        <button id="gemini-project-btn" class="gemini-btn gemini-btn-project">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                            أفكار مشاريع
                        </button>
                        <button id="gemini-plan-btn" class="gemini-btn gemini-btn-plan">
                           <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                           خطة مذاكرة
                        </button>
                        <button id="gemini-translate-btn" class="gemini-btn gemini-btn-translate">
                           <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m4.25 16a4.25 4.25 0 000-8.5H12a4.25 4.25 0 000 8.5h.25zM17 12a4.25 4.25 0 100-8.5H12a4.25 4.25 0 100 8.5h5zM3 17l6-6-6-6"></path></svg>
                           ترجمة المصطلحات
                        </button>
                         <button id="gemini-quiz-btn" class="gemini-btn gemini-btn-quiz">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                           ✨ اختبر فهمك
                        </button>
                        <button id="gemini-interview-btn" class="gemini-btn gemini-btn-interview">
                           <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a2 2 0 01-2-2V7a2 2 0 012-2h4M5 8h2m4 0h2"></path></svg>
                           ✨ سؤال مقابلة
                        </button>
                         <button id="gemini-review-btn" class="gemini-btn gemini-btn-review">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                           ✨ مراجعة الكود
                        </button>
                        <button id="gemini-career-btn" class="gemini-btn gemini-btn-career">
                           <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                            ✨ المسار الوظيفي
                        </button>
                        <button id="gemini-search-btn" class="gemini-btn gemini-btn-search">
                           <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                           ✨ ابحث عن مصادر
                        </button>
                        <button id="gemini-image-btn" class="gemini-btn gemini-btn-image">
                           <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l-1.586-1.586a2 2 0 00-2.828 0L6 18M20 16v.01M4 20h16a2 2 0 002-2V8a2 2 0 00-2-2H8a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                           ✨ اشرح صورة
                        </button>
                    </div>
                    <div id="gemini-loader" class="hidden my-4">
                        <div class="gemini-loader"></div>
                    </div>
                    <div id="gemini-response" class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg min-h-[100px] text-gray-700 dark:text-gray-300">
                        <p class="text-gray-500 dark:text-gray-400">اختر إحدى الميزات أعلاه لبدء استخدام المساعد الذكي.</p>
                    </div>
                </div>
            `;

            modalBody.innerHTML = staticContentHtml + geminiHtml + `<p id="copy-feedback" class="text-center mt-4 h-5"></p>`;
            modal.style.display = 'block';

            // ------------------------------------------------
            // --- START: Re-enable Event Listeners for Gemini ---
            // ------------------------------------------------

            document.getElementById('gemini-flashcard-btn').addEventListener('click', () => {
                const lessonsText = item.lessons.join(', ');
                let parallelLessonsText = '';
                if(item.parallelTrack) {
                    parallelLessonsText = item.parallelTrack.lessons.join(', ');
                }
                const prompt = `أنت مدرس خبير في البرمجة وتحليل البيانات. قم بإنشاء 4 بطاقات مراجعة (flashcards) للمفاهيم الأساسية في هذا الأسبوع. المواضيع هي: "${lessonsText}" والمسار الموازي هو "${parallelLessonsText}". لكل بطاقة، قدم المفهوم، وتعريفاً عربياً بسيطاً من جملة واحدة، ومثال كود C# قصير يوضح المفهوم.`;
                generateContent(prompt, false, FLASHCARD_SCHEMA);
            });

            document.getElementById('gemini-project-btn').addEventListener('click', () => {
                const prompt = `You are a creative programming mentor. Suggest 3 alternative project ideas for a student learning about "${item.title}" in C#. The original project is: "${item.project}". The new ideas should be slightly more challenging. For each idea, provide a name and a one-sentence description. Format the response as a simple list. Respond in Arabic.`;
                generateContent(prompt);
            });
            
            document.getElementById('gemini-plan-btn').addEventListener('click', () => {
                const csharpTopics = item.lessons.join(', ');
                const csharpProject = item.project;
                let parallelTrackInfo = '';
                if (item.parallelTrack) {
                    parallelTrackInfo = `The parallel track topics are ${item.parallelTrack.lessons.join(', ')} and the project is: ${item.parallelTrack.project}.`;
                }
                const prompt = `Act as an expert technical mentor. Create a 5-day study plan for a student for this week. The main topics are ${csharpTopics}. The main project is: ${csharpProject}. ${parallelTrackInfo} The plan should be actionable, balanced between theory and practice, and structured with daily goals (Day 1, Day 2, etc.). Format it as a list. Respond in Arabic.`;
                generateContent(prompt);
            });

            document.getElementById('gemini-translate-btn').addEventListener('click', () => {
                let terms = [...item.lessons];
                if (item.parallelTrack) {
                    terms.push(...item.parallelTrack.lessons);
                }
                 if (item.englishTrack) {
                    terms.push(...item.englishTrack.lessons);
                }
                const uniqueTerms = [...new Set(terms)];
                const termsString = uniqueTerms.join(', ');
                const prompt = `Provide the Arabic translation and a simple, one-sentence Arabic definition for the following technical terms: ${termsString}. Format the response as a list where each item is '**Term** - الترجمة: [translation] - الشرح: [definition]'. Respond in Arabic.`;
                generateContent(prompt);
            });
            
            document.getElementById('gemini-quiz-btn').addEventListener('click', () => {
                const lessonsText = item.lessons.join(', ');
                const prompt = `You are an expert C# and Data Analysis instructor. Create a single, challenging multiple-choice quiz question based on the following topics for this week: ${lessonsText}. Provide the question, 4 options (A, B, C, D), and then clearly state the correct answer and a brief, simple explanation of why it's correct. Respond in Arabic.`;
                generateContent(prompt);
            });

            document.getElementById('gemini-interview-btn').addEventListener('click', () => {
                const lessonsText = item.lessons.join(', ');
                const prompt = `You are a senior software engineer conducting a technical interview. Generate one common interview question for a junior developer role that is related to these topics: ${lessonsText}. Provide the question, and then provide a sample, ideal answer in bullet points. Respond in Arabic.`;
                generateContent(prompt);
            });

            document.getElementById('gemini-review-btn').addEventListener('click', () => {
                const geminiResponseContainer = document.getElementById('gemini-response');
                geminiResponseContainer.innerHTML = `
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">الصق الكود الخاص بمشروع هذا الأسبوع للحصول على مراجعة واقتراحات للتحسين.</p>
                    <textarea id="code-review-textarea" class="w-full h-40 p-2 border rounded-md bg-white dark:bg-gray-800 dark:border-gray-600 focus:ring-2 focus:ring-indigo-500" placeholder="...الصق الكود هنا"></textarea>
                    <button id="submit-code-review-btn" class="w-full mt-2 gemini-btn gemini-btn-review">احصل على مراجعة</button>
                `;

                document.getElementById('submit-code-review-btn').addEventListener('click', () => {
                    const userCode = document.getElementById('code-review-textarea').value;
                    if (!userCode.trim()) {
                        document.getElementById('gemini-response').innerHTML = '<p class="text-red-500">الرجاء لصق الكود أولاً.</p>';
                        return;
                    }
                    const prompt = `You are a senior C# developer and a strict but helpful code reviewer. The user is a student working on a project for week ${item.week} about '${item.title}'. The project is: '${item.project}'. They have provided the following code snippet. Please review it and provide constructive feedback in Arabic, focusing on best practices, potential bugs, and suggestions for improvement. Format your feedback as a list of bullet points. Here is the code: \n\n ${userCode}`;
                    generateContent(prompt);
                });
            });

            document.getElementById('gemini-career-btn').addEventListener('click', () => {
                const lessonsText = item.lessons.join(', ');
                const prompt = `You are a career advisor for software developers. Based on the skills learned in this week's topic, '${item.title}', which includes ${lessonsText}, what are 3 potential job titles or roles that heavily use these skills? For each role, provide a brief one-sentence description of what they do. Format as a list. Respond in Arabic.`;
                generateContent(prompt);
            });

            document.getElementById('gemini-search-btn').addEventListener('click', () => {
                const lessonsText = item.lessons.join(', ');
                const prompt = `You are a helpful research assistant. Find the 3 most recent and relevant tutorials or articles for a student learning about: "${lessonsText}". Provide the title, a one-sentence summary, and the URL for each. Respond in Arabic.`;
                generateContent(prompt, true); 
            });
            
            document.getElementById('gemini-image-btn').addEventListener('click', () => {
                const geminiResponseContainer = document.getElementById('gemini-response');
                geminiResponseContainer.innerHTML = `
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">ارفع لقطة شاشة لرسالة خطأ أو كود برمجي لتحليله.</p>
                    <input type="file" id="image-upload-input" accept="image/*" class="w-full text-sm text-gray-700 dark:text-gray-300
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-indigo-50 file:text-indigo-700
                        hover:file:bg-indigo-100 dark:file:bg-indigo-900/50 dark:file:text-indigo-300 dark:hover:file:bg-indigo-900
                    "/>
                `;

                document.getElementById('image-upload-input').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const lessonsText = item.lessons.join(', ');
                        const prompt = `أنت مبرمج C# خبير ومساعد في تصحيح الأخطاء. يقوم طالب بدراسة موضوع "${item.title}" (الدروس: ${lessonsText}). لقد قام الطالب برفع صورة، من المحتمل أن تكون لقطة شاشة لكود برمجي، أو رسالة خطأ، أو مخطط.
                        
                        قم بتحليل الصورة وقدم المساعدة التالية باللغة العربية:
                        1.  **تحليل:** اشرح ما تراه في الصورة (هل هو خطأ؟ كود؟).
                        2.  **السبب:** إذا كان خطأ، اشرح السبب المحتمل له.
                        3.  **الحل:** قدم حلاً مقترحاً أو خطوات لتصحيح الخطأ.
                        4.  **نصيحة:** قدم نصيحة إضافية تتعلق بالموضوع.
                        
                        كن ودوداً وداعماً.`;
                        generateContentWithImage(prompt, file);
                    }
                });
            });

            // ------------------------------------------------
            // --- END: Re-enable Event Listeners for Gemini ---
            // ------------------------------------------------

            modalBody.querySelectorAll('.copy-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const keyword = e.target.dataset.keyword;
                    navigator.clipboard.writeText(keyword).then(() => {
                        const feedback = document.getElementById('copy-feedback');
                        feedback.textContent = `تم نسخ: "${keyword}"`;
                        feedback.classList.add('copied-feedback');
                        setTimeout(() => {
                           feedback.textContent = '';
                           feedback.classList.remove('copied-feedback');
                        }, 2000);
                    });
                });
            });
        }

        filterButtonsContainer.addEventListener('click', e => {
            if (e.target.classList.contains('filter-btn')) {
                activePhaseFilter = e.target.dataset.phase;
                renderFilters();
                renderWeeks();
            }
        });
        statusFilterContainer.addEventListener('click', e => {
            if (e.target.classList.contains('status-filter-btn')) {
                activeStatusFilter = e.target.dataset.status;
                renderFilters();
                renderWeeks();
            }
        });
        
        weeksContainer.addEventListener('click', e => {
            const cardBody = e.target.closest('.week-card .p-6');
            const completeBtn = e.target.closest('.btn-complete');
            if (cardBody) {
                showModal(cardBody.dataset.week);
            } else if (completeBtn) {
                toggleWeekCompletion(completeBtn.dataset.weekId);
            }
        });

        closeModalBtn.onclick = () => modal.style.display = 'none';
        window.onclick = (event) => {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        function renderChart() {
            if (myChart) myChart.destroy();
            const phaseDurations = roadmapData.reduce((acc, item) => {
                acc[item.phase] = (acc[item.phase] || 0) + 1;
                return acc;
            }, {});
            const isDarkMode = document.documentElement.classList.contains('dark');
            const textColor = isDarkMode ? 'rgba(249, 250, 251, 0.9)' : 'rgba(55, 65, 81, 1)';
            const borderColor = isDarkMode ? '#1F2937' : '#FFFFFF';
            const ctx = document.getElementById('phasesChart').getContext('2d');
            const backgroundColors = ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#3B82F6', '#8B5CF6', '#EC4899', '#6366F1', '#22C55E', '#F97316', '#DC2626', '#0EA5E9'];
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(phaseDurations),
                    datasets: [{
                        label: 'عدد الأسابيع',
                        data: Object.values(phaseDurations),
                        backgroundColor: backgroundColors,
                        borderColor: borderColor,
                        borderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { family: 'Tajawal', size: 14 }, color: textColor }},
                        tooltip: { callbacks: { label: (c) => `${c.label}: ${c.parsed} أسابيع` }, bodyFont: { family: 'Tajawal' }, titleFont: { family: 'Tajawal' } }
                    }
                }
            });
        }
        
        // Initial Calls
        window.addEventListener('load', () => {
            loadState();
            handleThemeToggle();
            updateRoadmapDates();
            updateProgressBar();
            renderFilters();
            renderWeeks();
            renderChart();
        });
    </script>
</body>
</html>